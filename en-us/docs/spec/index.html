<!doctype html>
<html lang="en-us">
<head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1"><meta name="generator" content="Hugo 0.88.1" />
<link rel="apple-touch-icon" sizes="180x180" href='https://wiki.phala.network/favicons/apple-touch-icon.png'>
<link rel="icon" type="image/png" sizes="32x32" href='https://wiki.phala.network/favicons/favicon-32x32.png'>
<link rel="icon" type="image/png" sizes="16x16" href='https://wiki.phala.network/favicons/favicon-16x16.png'>
<link rel="manifest" href='https://wiki.phala.network/favicons/site.webmanifest'>
<link rel="mask-icon" href='https://wiki.phala.network/favicons/safari-pinned-tab.svg'  color="#004750">
<link rel="shortcut icon" href='https://wiki.phala.network/favicons/favicon.ico'>
<meta name="msapplication-config" content='https://wiki.phala.network/favicons/browserconfig.xml'>
<title>Technical Specification | Phala Network Wiki</title><meta property="og:title" content="Technical Specification" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://wiki.phala.network/en-us/docs/spec/" /><meta property="og:site_name" content="Phala Network Wiki" />

<meta itemprop="name" content="Technical Specification">
<meta itemprop="description" content=""><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Technical Specification"/>
<meta name="twitter:description" content=""/>


<link rel="stylesheet" href="https://wiki.phala.network/css/styles.1e7d152890d5ecbaf1af59d580d35c6656c8b30382e48d9f3ccd9cfb1b57ce0e7fcbe420bad4d3822b9e60c6bccfa68f1341665a52b80a837c106b510f57d294.css" integrity="sha512-Hn0VKJDV7Lrxr1nVgNNcZlbIswOC5I2fPM2c&#43;xtXzg5/y&#43;QgutTTgiueYMa8z6aPE0FmWlK4CoN8EGtRD1fSlA==">





  
  <link href="//fonts.googleapis.com/css?family=Roboto:300,400,700" rel="stylesheet">

</head>
  
    
  
<body class="page-section"data-code="100" data-lines="false" >
  <header class="nav_header">
<nav class="wrap nav menu">
	<a href="https://wiki.phala.network" class="nav_brand">
		<picture data-lit="https://wiki.phala.network/images/logo-phala-48.png" data-dark="https://wiki.phala.network/images/logo-phala-48.png">
			
			<img srcset = 'https://wiki.phala.network/images/logo-phala-48.png' alt = 'Phala Network Wiki Logo'>
		</picture>
		<label class="nav_toggle toggle" title='' role="button">
			<svg class="icon icon_harmburger">
  <use xlink:href="#harmburger"></use>
</svg>
		</label>
	</a>
	<ul class="nav_body">
		<li class="nav-item">
<div class="search">
  <label for="find" class="search_label"><svg class="icon icon_search">
  <use xlink:href="#search"></use>
</svg>
  </label>
  <input type="search" class="search_field" placeholder='' id="find" autocomplete="off">
  <div class="search_results results"></div>
</div>



		</li>
		<li class="nav-item">
			<a class="nav-link" href="https://wiki.phala.network/en-us/docs/"><span>Docs</span></a>
		</li>
		<li class="nav-item">
			<a class="nav-link" href="https://wiki.phala.network/zh-cn/"><span>中文</span></a>
		</li>
		<li class="nav-item">
			<a class="nav-link" href="https://wiki.phala.network/fr-fr/"><span>français</span></a>
		</li>
		<li class="nav-item">
			<a class="nav-link" href="https://phala.network"><span>Homepage</span></a>
		</li>
		
		<li class="nav-item nav_repo">
			<a class="nav-link" href="https://github.com/Phala-Network/phala-wiki/" target="_blank">
				
					GitHub
				
			</a>
		</li>
		<li class="nav-item">
<div class = 'color_mode'>
  <label for = 'mode'>
    <picture data-lit="https://wiki.phala.network/icons/sun.svg" data-dark="https://wiki.phala.network/icons/moon.svg">
      
      <img srcset = 'https://wiki.phala.network/icons/sun.svg' alt = 'Light/Dark Mode Icon' class="color_icon">
    </picture>
  </label>
  <input type = 'checkbox' class = 'color_choice' id = 'mode' title="Toggle Dark Mode">
</div>
</li>
	</ul>
</nav>

  </header>
  <div class="main wrap pt-4"><div class="grid-auto"><aside class="aside menu">
  <div>
    <label class="aside_toggle toggle" title='' role="button"> <svg class="icon icon_harmburger">
  <use xlink:href="#harmburger"></use>
</svg></label>
  </div>
  <section class="section aside_inner">
    <h2 class="section_title"><a  href="https://wiki.phala.network/en-us/docs/" class="group">Phala Network</a></h2>
      <section class="subsection" id="docs-phala-network">
  <section class="section aside_inner">
    <h2 class="section_title active"><a  href="https://wiki.phala.network/en-us/docs/spec/" class="group">Technical Specification</a></h2>
  </section>
  <section class="section aside_inner">
    <h2 class="section_title"><a  href="https://wiki.phala.network/en-us/docs/developer/" class="group">Developer Guide</a></h2>
      <section class="subsection" id="docs-developer-guide">
        <h3 class="section_link"><a id="docs-11-phala-blockchain-in-detail" href="https://wiki.phala.network/en-us/docs/developer/blockchain-in-detail/">1.1 Phala Blockchain in Detail</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#overview">Overview</a></li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-12-run-a-local-development-network" href="https://wiki.phala.network/en-us/docs/developer/run-a-local-development-network/">1.2 Run a Local Development Network</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#environment">Environment</a></li>
    <li><a href="#build-the-core-blockchain">Build the core blockchain</a></li>
    <li><a href="#build-the-web-ui">Build the Web UI</a></li>
    <li><a href="#play-the-guessnumber">Play the <code>GuessNumber</code></a>
      <ul>
        <li><a href="#authorization">Authorization</a></li>
        <li><a href="#play-with-it">Play with it</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-13-confidential-contract-examples" href="https://wiki.phala.network/en-us/docs/developer/your-first-confidential-contract/">1.3 Confidential Contract Examples</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#environment-and-build">Environment and Build</a></li>
    <li><a href="#walk-through-of-the-basic-confidential-contract">Walk-through of the Basic Confidential Contract</a>
      <ul>
        <li><a href="#contract">Contract</a></li>
        <li><a href="#frontend-sdk">Frontend SDK</a></li>
      </ul>
    </li>
    <li><a href="#advanced-feature-access-http-service-in-confidential-contracts">Advanced Feature: Access HTTP Service in Confidential Contracts</a></li>
    <li><a href="#summary">Summary</a>
      <ul>
        <li><a href="#submit-your-work">Submit Your Work</a></li>
      </ul>
    </li>
  </ul>
</nav>
      </section>
  </section>
  <section class="section aside_inner">
    <h2 class="section_title"><a  href="https://wiki.phala.network/en-us/docs/tokenomic/" class="group">Understand Phala Tokenomics</a></h2>
      <section class="subsection" id="docs-understand-phala-tokenomics">
        <h3 class="section_link"><a id="docs-1-secure-worker-mining-and-staking" href="https://wiki.phala.network/en-us/docs/tokenomic/1-mining-staking/">1 Secure Worker Mining and Staking</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#tee-mining-roles">TEE Mining Roles</a></li>
    <li><a href="#role-relationships">Role Relationships</a></li>
    <li><a href="#the-relationship-between-worker-and-stakepool">The Relationship between Worker and StakePool</a></li>
    <li><a href="#the-relationship-between-delegator-and-worker">The Relationship between Delegator and Worker</a></li>
    <li><a href="#case-1-insufficient-staking">Case 1: Insufficient Staking</a></li>
    <li><a href="#commission">Commission</a></li>
    <li><a href="#case-2-commission-setup-and-reward-distribution">Case 2: Commission Setup and Reward Distribution</a></li>
    <li><a href="#exit-staking">Exit Staking</a></li>
  </ul>
</nav>
      </section>
  </section>
  <section class="section aside_inner">
    <h2 class="section_title"><a  href="https://wiki.phala.network/en-us/docs/governance/" class="group">Governance</a></h2>
      <section class="subsection" id="docs-governance">
        <h3 class="section_link"><a id="docs-1-participate-in-democracy" href="https://wiki.phala.network/en-us/docs/governance/1-participate-in-democracy/">1 Participate in Democracy</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#participate-in-democracy">Participate in Democracy</a>
      <ul>
        <li><a href="#important-parameters">Important Parameters</a></li>
        <li><a href="#proposing-an-action">Proposing an Action</a></li>
        <li><a href="#submitting-a-preimage">Submitting a Preimage</a></li>
        <li><a href="#seconding-a-proposal">Seconding a Proposal</a></li>
        <li><a href="#voting-on-a-proposal">Voting on a Proposal</a></li>
        <li><a href="#unlocking-locked-tokens">Unlocking Locked Tokens</a></li>
        <li><a href="#delegate-a-vote">Delegate a Vote</a></li>
        <li><a href="#undelegate-a-vote">Undelegate a Vote</a></li>
        <li><a href="#voting-with-a-governance-proxy">Voting with a Governance Proxy</a></li>
        <li><a href="#interpreting-on-chain-voting-data">Interpreting On-Chain Voting Data</a></li>
      </ul>
    </li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-2-join-the-council" href="https://wiki.phala.network/en-us/docs/governance/2-join-the-council/">2 Join the Council</a></h3><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#submit-candidacy">Submit Candidacy</a></li>
        <li><a href="#voting-on-candidates">Voting on Candidates</a></li>
        <li><a href="#winning">Winning</a></li>
      </ul>
    </li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-3-voting-for-councillors" href="https://wiki.phala.network/en-us/docs/governance/3-voting-for-councillors/">3 Voting for Councillors</a></h3><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#voting-for-councillors">Voting for Councillors</a></li>
        <li><a href="#removing-your-vote">Removing your Vote</a></li>
      </ul>
    </li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-4-khala-treasury" href="https://wiki.phala.network/en-us/docs/governance/4-treasury/">4 Khala Treasury</a></h3><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#spending-proposals">Spending Proposals</a></li>
        <li><a href="#tipping">Tipping</a></li>
        <li><a href="#bounty-spending">Bounty Spending</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#creating-a-treasury-proposal">Creating a Treasury Proposal</a>
      <ul>
        <li><a href="#announcing-the-proposal">Announcing the Proposal</a></li>
        <li><a href="#creating-the-proposal">Creating the Proposal</a></li>
      </ul>
    </li>
    <li><a href="#tipping-1">Tipping</a>
      <ul>
        <li><a href="#example">Example</a></li>
      </ul>
    </li>
    <li><a href="#bounties-spending">Bounties Spending</a>
      <ul>
        <li><a href="#creating-a-bounty-proposal">Creating a Bounty Proposal</a></li>
        <li><a href="#closing-a-bounty">Closing a bounty</a></li>
      </ul>
    </li>
    <li><a href="#faq">FAQ</a>
      <ul>
        <li><a href="#what-prevents-the-treasury-from-being-captured-by-a-majority-of-the-council">What prevents the Treasury from being captured by a majority of the Council?</a></li>
      </ul>
    </li>
  </ul>
</nav>
      </section>
  </section>
  <section class="section aside_inner">
    <h2 class="section_title"><a  href="https://wiki.phala.network/en-us/docs/khala-user/" class="group">User Guides</a></h2>
      <section class="subsection" id="docs-user-guides">
        <h3 class="section_link"><a id="docs-polkadotjs-extension-guide" href="https://wiki.phala.network/en-us/docs/khala-user/polkadot-js-extension/">Polkadot{.js} Extension Guide</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#install-polkadotjs-extension">Install Polkadot{.js} Extension</a></li>
    <li><a href="#create-new-account">Create New Account</a></li>
    <li><a href="#import-existed-account">Import Existed Account</a>
      <ul>
        <li><a href="#import-with-mnemonic">Import with Mnemonic</a></li>
        <li><a href="#import-with-json">Import with JSON</a></li>
      </ul>
    </li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-guidance-of-delegation-stakepool" href="https://wiki.phala.network/en-us/docs/khala-user/stake-pool/">Guidance of Delegation StakePool</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#delegator">Delegator</a></li>
    <li><a href="#how-to-delegate">How to Delegate</a>
      <ul>
        <li><a href="#introduction-of-delegation">Introduction of Delegation</a></li>
        <li><a href="#choose-stakepool">Choose StakePool</a></li>
        <li><a href="#how-to-delegate-1">How to Delegate</a></li>
      </ul>
    </li>
    <li><a href="#check-delegation">Check Delegation</a></li>
    <li><a href="#potential-risks">Potential Risks</a></li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-set-up-identity" href="https://wiki.phala.network/en-us/docs/khala-user/set-up-identity/">Set Up Identity</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#setting-an-identity">Setting an Identity</a>
      <ul>
        <li><a href="#format-caveat">Format Caveat</a></li>
      </ul>
    </li>
    <li><a href="#judgements">Judgements</a>
      <ul>
        <li><a href="#requesting-a-judgement">Requesting a Judgement</a></li>
        <li><a href="#cancelling-a-judgement">Cancelling a Judgement</a></li>
        <li><a href="#khala-registrars">Khala Registrars</a></li>
      </ul>
    </li>
    <li><a href="#sub-accounts">Sub Accounts</a></li>
    <li><a href="#clearing-and-killing-an-identity">Clearing and Killing an Identity</a></li>
  </ul>
</nav>
      </section>
  </section>
  <section class="section aside_inner">
    <h2 class="section_title"><a  href="https://wiki.phala.network/en-us/docs/khala-mining/" class="group">Khala Pre-mainnet Mining Guide</a></h2>
      <section class="subsection" id="docs-khala-pre-mainnet-mining-guide">
        <h3 class="section_link"><a id="docs-11-check-your-hardware-bios-and-system" href="https://wiki.phala.network/en-us/docs/khala-mining/1-1-hardware-requirements/">1.1 Check Your Hardware, BIOS and System</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#general-khala-hardware-requirements">General Khala Hardware Requirements</a></li>
    <li><a href="#check-your-cpu">Check Your CPU</a></li>
    <li><a href="#check-bios-settings">Check BIOS settings</a></li>
    <li><a href="#supported-operating-systems-ubuntu-1804-and-2004">Supported Operating Systems: Ubuntu 18.04 and 20.04</a>
      <ul>
        <li><a href="#references">References</a></li>
      </ul>
    </li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-12-install-phala-tools" href="https://wiki.phala.network/en-us/docs/khala-mining/1-2-download-setup-scripts/">1.2 Install Phala Tools</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#prerequisites">Prerequisites</a></li>
    <li><a href="#download-phala-scripts">Download Phala Scripts</a></li>
    <li><a href="#activate-sgx-software-with-sgx_enable">Activate SGX Software with sgx_enable</a></li>
    <li><a href="#install-phala-tools">Install Phala Tools</a></li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-13-check-the-sgx-capability-and-confidence-level" href="https://wiki.phala.network/en-us/docs/khala-mining/1-3-confidential-level-evaluation/">1.3 Check the SGX Capability and Confidence Level</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#double-check-the-sgx-capability">Double Check the SGX Capability</a></li>
    <li><a href="#confidence-level-of-a-miner">Confidence Level of a Miner</a></li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-14-benchmarking" href="https://wiki.phala.network/en-us/docs/khala-mining/1-4-benchmarking/">1.4 Benchmarking</a></h3><nav id="TableOfContents"></nav>
        <h3 class="section_link"><a id="docs-2-solo-mining-configuration" href="https://wiki.phala.network/en-us/docs/khala-mining/2-solo-mining/">2 Solo mining configuration</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#install">Install</a></li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-21-deploy-worker-node" href="https://wiki.phala.network/en-us/docs/khala-mining/2-1-deploy-worker-node/">2.1 Deploy Worker Node</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#start-mining">Start Mining</a></li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-22-verify-worker-status" href="https://wiki.phala.network/en-us/docs/khala-mining/2-2-verify-worker-status/">2.2 Verify Worker Status</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#verify-worker-status">Verify Worker Status</a></li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-23-upgrade-worker-node" href="https://wiki.phala.network/en-us/docs/khala-mining/2-3-upgrade-worker-node/">2.3 Upgrade Worker Node</a></h3><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#update-and-wipe-data">Update and wipe data</a></li>
      </ul>
    </li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-24-use-console-to-manage-your-mining" href="https://wiki.phala.network/en-us/docs/khala-mining/2-4-console/">2.4 Use Console to Manage Your Mining</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#console-manual">Console Manual</a>
      <ul>
        <li><a href="#prerequisites">Prerequisites</a></li>
        <li><a href="#console-operations">Console Operations</a></li>
        <li><a href="#other-operations">Other Operations</a></li>
        <li><a href="#explanations-of-fields">Explanations of Fields</a>
          <ul>
            <li><a href="#stakepool-list">Stakepool List</a></li>
            <li><a href="#worker-list">Worker List</a></li>
            <li><a href="#stake-info">Stake Info</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-3-frequently-asked-questions" href="https://wiki.phala.network/en-us/docs/khala-mining/4-faq/">3 Frequently Asked Questions</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#i-increase-confidence-level">I. Increase Confidence Level</a>
      <ul>
        <li><a href="#got-configuration_needed-and-configuration_and_sw_hardening_needed">Got CONFIGURATION_NEEDED and CONFIGURATION_AND_SW_HARDENING_NEEDED</a></li>
        <li><a href="#got-group_out_of_date">Got GROUP_OUT_OF_DATE</a></li>
        <li><a href="#how-to-update-workers-from-para2-to-khala">How to update workers from Para2 to Khala</a></li>
        <li><a href="#got-unable-to-retrieve-header-and-parent-from-supplied-hash-during-node-syncing">Got &ldquo;Unable to retrieve header and parent from supplied hash&rdquo; during node syncing</a></li>
        <li><a href="#how-to-check-the-version-of-the-running-node">How to check the version of the running node</a></li>
      </ul>
    </li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-31-how-to-get-better-peers-connectivity" href="https://wiki.phala.network/en-us/docs/khala-mining/4-1-how-to-get-better-peers-connectivity/">3.1 How to get better peers connectivity</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#the-problem">The problem</a></li>
    <li><a href="#stateful-firewall">Stateful firewall</a>
      <ul>
        <li><a href="#what-these-stateful-firewalls-do">What these stateful firewalls do</a>
          <ul>
            <li><a href="#source-nat">Source NAT</a></li>
            <li><a href="#policy-based-filter">Policy-based filter</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#what-to-do">What to do</a>
      <ul>
        <li><a href="#get-rid-of-nat-or-filter-at-all">Get rid of NAT or filter at all</a></li>
        <li><a href="#configure-your-own-device-to-get-better-connectivity">Configure your own device to get better connectivity</a>
          <ul>
            <li><a href="#destination-nat-dmz-or-upnp">Destination NAT, DMZ, or UPnP</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-32-how-to-accelerate-your-node-syncing-if-you-havent-fully-synced-yet" href="https://wiki.phala.network/en-us/docs/khala-mining/4-2-how-to-fast-sync-node-use-snapshot/">3.2 How to accelerate your node syncing if you haven&#39;t fully synced yet</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#problem">Problem</a></li>
    <li><a href="#download-latest-snapshot-updated-in-9182021">Download latest snapshot (Updated in 9/18/2021)</a></li>
    <li><a href="#preparation">Preparation</a></li>
    <li><a href="#replace-local-data-with-extracted-snapshot">Replace local data with extracted snapshot</a>
      <ul>
        <li><a href="#if-youre-a-solo-miner">If you&rsquo;re a solo miner</a></li>
        <li><a href="#advanced-miner">Advanced miner</a></li>
      </ul>
    </li>
    <li><a href="#restart-phala-services">Restart Phala services</a></li>
  </ul>
</nav>
      </section>
  </section>
  <section class="section aside_inner">
    <h2 class="section_title"><a  href="https://wiki.phala.network/en-us/docs/para-mining/" class="group">Para-2 Testnet Mining Guide</a></h2>
      <section class="subsection" id="docs-para-2-testnet-mining-guide">
        <h3 class="section_link"><a id="docs-claim-test-token-from-telegram-bot" href="https://wiki.phala.network/en-us/docs/para-mining/claim-test-token/">Claim Test Token from Telegram Bot</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#claim-test-token-from-telegram-bot">Claim Test Token from Telegram Bot</a></li>
  </ul>
</nav>
      </section>
  </section>
  <section class="section aside_inner">
    <h2 class="section_title"><a  href="https://wiki.phala.network/en-us/docs/prb/" class="group">Runtime Bridge</a></h2>
      <section class="subsection" id="docs-runtime-bridge">
        <h3 class="section_link"><a id="docs-deployment-with-containers-an-example-with-docker-compose" href="https://wiki.phala.network/en-us/docs/prb/docker-compose-example/">Deployment with Containers: An Example with Docker Compose</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#requirements">Requirements</a></li>
    <li><a href="#prepare-the-environment">Prepare the environment</a></li>
    <li><a href="#base-services">Base Services</a></li>
    <li><a href="#the-fetch-service">The <code>fetch</code> Service</a></li>
    <li><a href="#the-trade-service">The <code>trade</code> Service</a></li>
    <li><a href="#the-lifecycle-service">The <code>lifecycle</code> Service</a></li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-running-directly-in-linux" href="https://wiki.phala.network/en-us/docs/prb/running-directly/">Running Directly in Linux</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#requirements">Requirements</a></li>
    <li><a href="#set-up-dependencies-and-generate-protobuf-interfaces">Set up dependencies and generate Protobuf interfaces</a></li>
    <li><a href="#start-services">Start Services</a></li>
  </ul>
</nav>
      </section>
  </section>
  <section class="section aside_inner">
    <h2 class="section_title"><a  href="https://wiki.phala.network/en-us/docs/maintain/" class="group">Maintain</a></h2>
      <section class="subsection" id="docs-maintain">
        <h3 class="section_link"><a id="docs-collator" href="https://wiki.phala.network/en-us/docs/maintain/collator/">Collator</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#concepts">Concepts</a></li>
    <li><a href="#prepare-a-new-collator">Prepare a new collator</a></li>
    <li><a href="#enable-an-invulnerable-collator">Enable an invulnerable collator</a></li>
    <li><a href="#apply-for-a-public-collator">Apply for a public collator</a></li>
  </ul>
</nav>
      </section>
  </section>
  <section class="section aside_inner">
    <h2 class="section_title"><a  href="https://wiki.phala.network/en-us/docs/pdiem/" class="group">pDiem</a></h2>
      <section class="subsection" id="docs-pdiem">
        <h3 class="section_link"><a id="docs-deploy-local-testnet" href="https://wiki.phala.network/en-us/docs/pdiem/deploy-local-testnet/">Deploy Local Testnet</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#prepare">Prepare</a></li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-play-with-pdiem" href="https://wiki.phala.network/en-us/docs/pdiem/play-with-pdiem/">Play with pDiem</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#create-diem-accounts">Create Diem accounts</a></li>
    <li><a href="#simple-diem-to-pdiem-transfer">Simple diem-to-pdiem transfer</a>
      <ul>
        <li><a href="#balances-in-pdiem">Balances in pdiem</a></li>
        <li><a href="#verified-transactions">Verified transactions</a></li>
      </ul>
    </li>
    <li><a href="#prepare-subaccounts-for-two-way-transfer">Prepare subaccounts for two-way transfer</a></li>
    <li><a href="#deposit-diem--pdiem">Deposit (diem → pdiem)</a></li>
    <li><a href="#withdraw-pdiem--diem">Withdraw (pdiem → diem)</a></li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-reservation-based-model" href="https://wiki.phala.network/en-us/docs/pdiem/reservation-based-model/">Reservation-based Model</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#deposit">Deposit</a></li>
    <li><a href="#transfer">Transfer</a></li>
    <li><a href="#withdraw">Withdraw</a></li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-light-validation-client" href="https://wiki.phala.network/en-us/docs/pdiem/light-validation-client/">Light Validation Client</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#the-basics">The Basics</a></li>
    <li><a href="#light-client">Light Client</a></li>
    <li><a href="#the-diem-blockchain">The Diem Blockchain</a></li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-contract-implementation" href="https://wiki.phala.network/en-us/docs/pdiem/contract-implementation/">Contract Implementation</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#contract-storage">Contract storage</a></li>
    <li><a href="#light-client-implementation">Light client implementation</a></li>
    <li><a href="#receive-deposit-transactions">Receive deposit transactions</a></li>
    <li><a href="#sign-withdraw-transactions">Sign withdraw transactions</a></li>
    <li><a href="#assets-transfer">Assets transfer</a></li>
    <li><a href="#reference">Reference</a></li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-the-relayer" href="https://wiki.phala.network/en-us/docs/pdiem/the-relayer/">The Relayer</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#who-runs-the-relayer">Who runs the relayer</a></li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-future-works" href="https://wiki.phala.network/en-us/docs/pdiem/future-works/">Future Works</a></h3><nav id="TableOfContents"></nav>
        <h3 class="section_link"><a id="docs-advanced-hardware-mode" href="https://wiki.phala.network/en-us/docs/pdiem/hardware-mode/">Advanced: Hardware Mode</a></h3><nav id="TableOfContents"></nav>
      </section>
  </section>
      </section>
  </section>
</aside>

  <main class="content">
    <h1>Technical Specification</h1><script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$','$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  };
  window.addEventListener('load', (event) => {
      document.querySelectorAll("mjx-container").forEach(function(x){
        x.parentElement.classList += 'has-jax'})
    });
</script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<p>This document describes the the technical specification of Phala Network including the overall protocol and the detailed data structure and algorithm. It&rsquo;s still a work-in-progress.</p>
<h2 id="blockchain-entities">Blockchain Entities</h2>
<p>In Phala Network, there are three kinds of entities:</p>
<ul>
<li><em>Client</em>, which operates on normal devices without any special hardware requirement;</li>
<li><em>Worker</em>, which operates on TEE (<em>Trusted Execution Environment</em>) and serves as the computation nodes for confidential smart contracts;</li>
<li><em>Gatekeeper</em>, which operates on TEE and serves as the authorities and key managers;</li>
</ul>
<p>We present the interactions between different entities as follow.</p>
<p><img src="/images/docs/spec/phala-design.png" alt="Phala Network"></p>
<p>The basic design of Phala Network meant to ensure the security and confidentiality of the blockchain and the smart contracts on it. With the introducing of more security improvements, Phala Network is able to defend advanced attacks.</p>
<h3 id="entity-key-initialization">Entity Key Initialization</h3>
<p>In Phala, the communication between any entities should be encrypted, so each entity generates the following entity key pairs with pseudorandom number generator during initialization:</p>
<ol>
<li><code>IdentityKey</code>
<ul>
<li>a <code>secp256k1</code> key pair to uniquely identify an entity;</li>
</ul>
</li>
<li><code>EcdhKey</code>
<ul>
<li>a <code>secp256r1</code> key pair for secure communication;</li>
</ul>
</li>
</ol>
<blockquote>
<p><strong>[Improvement]</strong></p>
<p>Switch both <code>IdentityKey</code> and <code>EcdhKey</code> to <code>sr25519</code> in the future. <a href="https://ristretto.group/">The Ristretto group</a> has a good ecosystem in Rust (which can be easily compiled to WASM) and JavaScript, even with ECDH support.</p>
</blockquote>
<p>For clients, the key pairs are generated by the user&rsquo;s wallet. While for workers and gatekeepers, the key pairs are fully managed by <code>pRuntime</code> and their usage is strictly limited.</p>
<h3 id="pruntime-initialization"><code>pRuntime</code> Initialization</h3>
<p>During initialization, <code>pRuntime</code> automatically generates the entity key pairs above with pseudorandom number generator. The generated key pairs are managed in <code>pRuntime</code> in TEE, which means the workers and gatekeepers can only use it with the limited APIs exported by <code>pRuntime</code>, and can never gain the plaintext key pairs to read the encrypted data out of TEE.</p>
<p>The generated key pairs can be locally encrypted and cached on the disk by <code>SGX Sealing</code>, and can be decrypted and loaded when restarting. This applies to both gatekeepers and workers.</p>
<h3 id="secure-communication-channels">Secure Communication Channels</h3>
<p>The <code>EcdhKey</code> public key in the <code>pRuntime</code> of a worker or gatekeeper is publicly available. Therefore a <a href="https://wiki.openssl.org/index.php/Elliptic_Curve_Diffie_Hellman">ECDH key agreement protocol</a> can be applies to establish a secure communication channel between a worker (or a gatekeeper) and any other entity non-interactively.</p>
<p>A channel between two entities <code>A</code> and <code>B</code> is denoted as $Channel(Pk_A, Pk_B)$, where $Pk_A$ and $Pk_B$ is the public key of their ECDH key pairs correspondingly. A shared secret can be derived from one&rsquo;s ECDH private key and the counterpart&rsquo;s public key via Diffie Hellman algorithm. Then the final communication key <code>CommKey(A, B)</code> can be calculated via a one-way function. <code>CommKey(A, B)</code> is used to encrypt the messages between the two entities.</p>

<div class="tip">
  <p>In pre-mainnet, the <code>EcdhKey</code> is a <code>secp256r1</code> key pair. We can adopt the <a href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki#child-key-derivation-ckd-functions">child key derivation (CKD) functions</a> from Bitcoin BIP32 to derive <code>CommKey(A, B)</code> from the key agreed by ECDH.</p>
<p>The messages are E2EE with <code>aes-gcm-256</code>.</p>

</div>

<blockquote>
<p><strong>[Improvement]</strong>
When we switch to sr25519, we should adopt Substrate&rsquo;s key derivation algorithm instead of BIP32.</p>
</blockquote>
<p>The public key of the entities are registered on-chain. So we can build on-chain or off-chain communication channels:</p>
<ul>
<li>On-chain Communication
<ol>
<li>Both <code>A</code> and <code>B</code> knows each other&rsquo;s public key from the blockchain. They can derives <code>CommKey(A, B)</code>;</li>
<li><code>A</code> posts a cipher message encrypted by <code>CommKey(A, B)</code> to the blockchain;</li>
<li><code>B</code> receives it, and decrypt it with <code>CommKey(A, B)</code>;</li>
</ol>
</li>
<li>Off-chain (<code>A</code> is off-chain and <code>B</code> is an on-chain worker) Communication
<ol>
<li><code>A</code> can learn <code>B</code>&rsquo;s public key from the blockchain and derive <code>CommKey(A, B)</code>;</li>
<li><code>A</code> learns the API endpoint of <code>B</code> from its <code>WorkerInfo</code> in <code>WorkerState</code> on chain;</li>
<li><code>A</code> sends a signed cipher message (encrypted by <code>CommKey(A, B)</code>) with its public key to <code>B</code> directly;</li>
<li><code>B</code> gets <code>A</code>&rsquo;s public key from the message, and derive <code>CommKey(A, B)</code> to decrypt it;</li>
</ol>
</li>
</ul>
<h4 id="client-worker-payload-example">Client-worker Payload Example</h4>
<p>A client communicates with a worker only for contract invocation. An invocation is consisted of at least the following payloads.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="ln">1</span><span class="p">{</span>
<span class="ln">2</span>    <span class="nx">from</span><span class="o">:</span> <span class="nx">Client_IdentityKey</span><span class="p">,</span>
<span class="ln">3</span>    <span class="nx">payload</span><span class="o">:</span> <span class="p">{</span>
<span class="ln">4</span>        <span class="nx">to</span><span class="o">:</span> <span class="nx">Contract_IdentityKey</span><span class="p">,</span>
<span class="ln">5</span>        <span class="nx">input</span><span class="o">:</span> <span class="s2">&#34;0xdeadbeef&#34;</span><span class="p">,</span>
<span class="ln">6</span>    <span class="p">},</span>
<span class="ln">7</span>    <span class="nx">nonce</span><span class="o">:</span> <span class="mi">12345</span><span class="p">,</span>
<span class="ln">8</span>    <span class="nx">sig</span><span class="o">:</span> <span class="nx">UserSignature</span><span class="p">,</span>
<span class="ln">9</span><span class="p">}</span>
</code></pre></div><ul>
<li><code>nonce</code> is necessary for defending against Double-spend and Replay Attack.</li>
<li><code>from</code> field shows the identity of caller, and can be verified with <code>sig</code>. <code>from</code> will be further passed to contract.</li>
<li>Since a worker can run multiple contracts (or even different instances of the same contract), <code>to</code> is needed to specify the invocation target.</li>
<li><code>input</code> encodes the invoked function and arguments, it should be serialized according to the ABI of contracts.</li>
</ul>
<blockquote>
<p><strong>[Improvement]</strong></p>
<h3 id="serialization">Serialization</h3>
<p>Currently the paylaods are serialized in browser-friendly JSON, but it&rsquo;s very space inefficient. Use some compact binary format instead (e.g. Protobuf, parity-scale-codec).</p>
<h3 id="ecdhkey-rotation"><code>EcdhKey</code> Rotation</h3>
<p>Unlike the <code>IdentityKey</code> which shows the identity of a worker or gatekeeper thus should not be changed, we recommend a regular rotation of the <code>EcdhKey</code> to ensure the security of the communication channels between different entities. In the future, <code>pRuntime</code> will automatically rotate the managed <code>EcdhKey</code> key after certain time interval.</p>
</blockquote>
<h2 id="worker">Worker</h2>
<h3 id="worker-registration">Worker Registration</h3>
<p>Registration is required before a worker or gatekeeper can join the network. Any parties with TEE-supported devices can serve as workers. To register as a validated worker in the blockchain, TEE runners need to run <code>pRuntime</code> and let it send a signed attestation report to gatekeepers.</p>
<p><code>pRuntime</code> requests a Remote Attestation with a hash of the <code>WorkerInfo</code> committed in the attestation report. <code>WorkerInfo</code> includes the public key of <code>IdentityKey</code> and <code>EcdhKey</code> and other data collected from the enclave. By verifying the report, gatekeepers can know the hardware information of workers and ensure that they are running unmodified <code>pRuntime</code>.</p>
<h3 id="remote-attestation">Remote Attestation</h3>
<p>The attestation report is relayed to the blockchain by <code>register_worker()</code> call. The blockchain has the trusted certificates to validate the attestation report. It validates:</p>
<ol>
<li>The signature of the report is correct;</li>
<li>The embedded hash in the report matches the hash of the submitted <code>WorkerInfo</code>;</li>
</ol>
<p><code>register_worker()</code> is called by workers, and a worker can only be assigned contracts when it has certain amounts of staking PHA tokens. On the blockchain there is a <code>WorkerState</code> map from the worker to the <code>WorkerInfo</code> entry. Gatekeepers will update the <code>WorkerState</code> map after they receive and verify the submitted <code>WorkerInfo</code>.</p>
<h3 id="offline-worker-detection">Offline Worker Detection</h3>
<p>The <code>pRuntime</code> of a worker is regularly required to answer the online challenge as a heartbeat event on chain. The blockchain detects the liveness of workers by monitoring the interval of their heartbeat events. A worker is punished with the penalty of his staking tokens if it goes offline during contract execution</p>
<blockquote>
<p><strong>[Improvement]</strong></p>
<p>Contract deployers are allowed to set a configurable timeout of the contract execution. Accordingly, an execution is regarded to be failed if the worker fails to provide the results within the timeout. A minor penalty (compared to offline penalty) needs to be payed.</p>
</blockquote>
<blockquote>
<p><strong>[TODO: Current Impl]</strong></p>
<p>Now we have a random challenge for workers. If a worker correctly answers the challenge, it gets rewarded (based on the tokenomics). Otherwise if it fails to respond within a time window, it gets slashed.</p>
<p>Subject to changes: we may want to 100% occupy the CPU cycles.</p>
</blockquote>
<h2 id="gatekeeper">Gatekeeper</h2>
<h3 id="gatekeeper-election">Gatekeeper Election</h3>
<p>Gatekeepers share the same <code>pRuntime</code> as normal workers. To distinguish gatekeepers, their <code>IdentityKey</code> public keys are recorded in the <code>GatekeeperState</code> list on blockchain.</p>
<p>In the pre-mainnet of Phala Network, the list of gatekeepers is hard-coded in the genesis block of the blockchain.</p>
<blockquote>
<p><strong>[Improvement]</strong></p>
<p>Gatekeepers are elected on blockchain by NPoS mechanism similar to Polkadot. This is done by <code>Staking</code> pallet, where nominators can stake their tokens, and vote for their trusted gatekeepers. Once a gatekeeper is elected, both itself and the nominators can get PoS reward from PHA inflation.</p>
</blockquote>
<h3 id="masterkey-generation"><code>MasterKey</code> Generation</h3>
<p><code>MasterKey</code> is used to derive the keys to encrypt the states of confidential smart contracts and communicate. In Phala Network, only the <code>pRuntime</code> of a gatekeeper is authorized to manage the <code>MasterKey</code>. Noted that since <code>MasterKey</code> is managed by <code>pRuntime</code> and its usage is limited, even a malicious gatekeeper cannot decrypt any contract states without fully compromising the TEE and <code>pRuntime</code>.</p>
<p><code>MasterKey</code> is a <code>secp256k1</code> key pair generated and managed by gatekeepers.</p>
<blockquote>
<p><strong>[Improvement]</strong></p>
<p>Switch to <code>sr25519</code> in the future.</p>
</blockquote>
<p>In the pre-mainnet of Phala Network, all the gatekeepers share the same pre-generated <code>MasterKey</code>.</p>
<blockquote>
<p><strong>[Improvement]</strong></p>
<p>Introduce DKG (<em><a href="https://en.wikipedia.org/wiki/Distributed_key_generation">distributed key generation</a></em>) so that more than one gatekeepers are required to produce <code>MasterKey</code>, and each gatekeeper only hold a share of the key. When DKG is enabled, the contract key shares are provisioned to the workers by the gatekeepers separately.</p>
</blockquote>
<blockquote>
<p><strong>[Improvement]</strong>
Rotation of Shared <code>MasterKey</code></p>
<p>Similar to the rotation of <code>EcdhKey</code>, the <code>MasterKey</code> needs to be rotated regularly to achieve forward secrecy, and defend any attempts to leak <code>MasterKey</code> and decrypt the contract states.</p>
<p>The rotation of <code>MasterKey</code> is triggered after certain interval of block height. The key to <code>MasterKey</code> rotation is the re-encryption of saved contract states. It may take several blocks to complete. <code>MasterKey</code> rotation is consisted of the following steps:</p>
<ul>
<li>Gatekeepers generate new <code>MasterKey</code>;</li>
<li>Gatekeepers use old <code>MasterKey</code> to decrypt the saved contract states, and use new <code>MasterKey</code> to encrypt them in parallel;</li>
<li>The old <code>MasterKey</code> and saved contract states are abandoned;</li>
</ul>
<p>Again, since all these operations happen inside <code>pRuntime</code> in TEE, the gatekeepers themselves cannot take a peek at the contract states.</p>
</blockquote>
<h3 id="state-migration">State Migration</h3>
<p>We must make sure the data can be migrated to a new version of blockchain and pRuntime without revealing the contents. The state migration is triggered by on-chain governance decision denoted by an event, and can be achieved in the same way we proposed for <code>MasterKey</code> rotation.</p>
<h2 id="confidential-smart-contracts">Confidential Smart Contracts</h2>
<h3 id="contract-key-generation">Contract Key Generation</h3>
<p>A client should upload the signed contract code with code hash to the blockchain. Once a client uploads a confidential contract to the blockchain, it emits an event <code>ContractUploaded(deployer_id, code_hash, sequence)</code>. Gatekeepers keep listening to such events, and generate a contract key for each newly deployed contract.</p>
<p>The contract key is generated by a KDF (<em><a href="https://en.wikipedia.org/wiki/Key_derivation_function">key derivation function</a></em>). In pre-mainnet, we adopt the <a href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki#child-key-derivation-ckd-functions">child key derivation (CKD) functions</a> from Bitcoin, and extra data like <code>deployer_id</code> serves as entropy during key derivation:</p>
<p>$$
ContractKey_{deployer\_id, code\_hash, sequence} = KDF(MasterKey, deployer\_id, code\_hash, sequence)
$$</p>
<p>The following keys are needed for a contract, and are derived from the <code>ContractKey</code>:</p>
<ul>
<li><code>IdentityKey</code>
<ul>
<li>a <code>secp256k1</code> key pair, used to sign the output messages of the contract;</li>
</ul>
</li>
<li><code>EcdhKey</code>
<ul>
<li>a <code>secp256r1</code> key pair, used to encrypt the IO to the contract (including both Commands and Queries);</li>
</ul>
</li>
<li><code>StorageKey</code>
<ul>
<li>an <code>aes-256-gcm</code> key. <code>StorageKey</code> can be generated in the same way as <code>EcdhKey</code> by introducing extra nonce, it is used to encrypted the contract states (a.k.a. key-value pairs in contract storage);</li>
</ul>
</li>
</ul>
<p>In the pre-mainnet of Phala Network, the contract keys above do not need to be stored inside gatekeepers' <code>pRuntime</code> storage because it is easy to generate them on-the-fly.</p>
<p>When the key is generated, the <code>ContractKey</code> public key is included in the <code>ContractInfo</code>. <code>ContractInfo</code> should also include the identity of contract deployer, sequence, contract code hash and (optional) contract source code. Gatekeepers can easily reproduce <code>ContractKey</code> on-the-fly given the <code>ContractInfo</code> (since <code>MasterKey</code> is managed by them) for future verification and migration.</p>
<h3 id="contract-key-provision">Contract Key Provision</h3>
<p>To assign a contract to a worker, gatekeepers first retrieve the <code>ContractInfo</code> of the contract and generates <code>ContractKey</code> on-the-fly.</p>
<p>Gatekeepers will only provision the keys to the qualified workers. It establishes a on-chain secure communication channel and passes <code>ContractInfo</code> and <code>ContractKey</code> key pairs.</p>
<blockquote>
<p><strong>[Improvement]</strong></p>
<p>Allow the deployers to specify the hardware requirements and number of replications in <code>ContractInfo</code> and gatekeepers should assign desired workers.</p>
</blockquote>
 <!-- ==TODO2: a lighter way to assign tasks before we work on any real algorithm?== -->
<blockquote>
<p><strong>[TODO]</strong></p>
<p>Allow to create worker whitelist (subnet), allow users to choose which list to deploy contracts. All workers in a subnet are replicates.</p>
</blockquote>
<p>Gatekeepers emit a <code>ContractDeployed(Worker_IdentityKey, ContractKey)</code> event (multiple events should be emitted if there are multiple workers). We keep a <code>ContractState</code> map from <code>ContractKey</code> to the worker on chain. Gatekeepers will keep the <code>ContractState</code> map up-to-date so deployers can locate the assigned workers.</p>
<h4 id="commands-invocation">Commands Invocation</h4>
<p>A client takes the following step to send Commands to contract:</p>
<ol>
<li>Use contract&rsquo;s <code>EcdhKey</code> key and client&rsquo;s private key to apply Ecdh;</li>
<li>Use the generated key to encrypt invocation data;</li>
<li>Post a <code>ContractCommand(ContractKey, Client_IdentityKey, encrypted_data)</code> event on chain;</li>
</ol>
<p>Noted that since the invocation data is encrypted with a secret generated by client&rsquo;s private key and contract&rsquo;s public key, only executed contract itself (not assigned worker) can decrypt the invocation data. Also, new workers can be assigned for re-execution if previous assigned worker is offline.</p>
<p>The worker should keep listening to the <code>ContractCommand</code> events to the contract after deployment.</p>
<h4 id="queries-invocation">Queries Invocation</h4>
<p>A client can post a <code>ContractQuery(query_id, ContractKey, Client_IdentityKey, encrypted_data)</code> in the same way as above. And workers should listen such events and return a <code>ContractReturn(return_id, query_id, encrypted_return_value)</code> accordingly.</p>
<blockquote>
<p><strong>[Improvement]</strong></p>
<p>We will include the API endpoint of workers in <code>WorkerState</code>. A client can directly get the workers of certain contract by listening to <code>ContractDeployed</code> events, then it establishes a secure communication channel with workers and send queries.</p>
</blockquote>
<!-- ==TODO: assume all the workers have *public accessible* API endpoint== -->
<blockquote>
<p><strong>[TODO]</strong></p>
<p>Ensure the connectivity of workers.</p>
</blockquote>
<blockquote>
<p><strong>[TODO]</strong></p>
<p>How to punish inaccessible workers?
Before we have a way to make connectivity stable, we must either use whitelist (user can trust the operators), or allow querying on the blockchain (very high latency and expensive).</p>
</blockquote>
<h3 id="contract-execution">Contract Execution</h3>
<p>The key to confidential contract execution is the decryption and update of contract states (a.k.a. all the key-value pairs in contract storage).</p>
<p>For now, we prefer to adopt the following confidential storage model: the key and value are first encrypted by <code>StorageKey</code> of the contract and then inserted into the trie storage, so the underlying database engine can be agnostic about the encryption. Each key-value pair is encrypted with different key derived from <code>StorageKey</code>:</p>
<ul>
<li>$StorageKey_{key} = KDF(StorageKey, key)$</li>
</ul>
<h4 id="state-update">State Update</h4>
<p>The state update written back to chain need to be signed with <code>ContractKey</code>, so a worker cannot provide false state update without cracking TEE and <code>pRuntime</code>. A trivial solution for state update is that worker writes back all the updates of key-value pairs after the execution of a command. Worker should also update the timestamp (i.e., block height of the latest-processed transaction) in storage so we can know which transactions have already been processed.</p>
<p>This solution applies to the situation when a little contracts are deployed and limited commands are processed.</p>
<blockquote>
<p><strong>[Improvement]</strong></p>
<p>With the increasing number of contracts, certain cache mechanism is necessary, i.e., the worker can cache and merge all the changes to contract state (by keys, only the latest value of a key is preserved) and only update the Substrate storage after certain interval. The interval needs to be carefully chosen to prevent all the workers update states in the same block (e.g., <a href="https://zh.wikipedia.org/wiki/%E5%91%A8%E6%9C%9F%E8%9D%89">13 or 17</a> blocks). Noted that the longer the interval is, the less update will be applied to the storage, while there will be more replay tasks if the worker is down.</p>
</blockquote>
<blockquote>
<p><strong>[Improvement]</strong></p>
<h4 id="state-update-arbitration">State Update Arbitration</h4>
<p>The observable state update conflicts of multiple workers are automatically handled by <a href="https://substrate.dev/docs/en/knowledgebase/advanced/consensus">consensus</a>. If only one worker is executing the contract, it can provide wrong state update without being noticed. Noted that this can only achieved if the malicious worker manages to extract the <code>ContractKey</code> from <code>pRuntime</code>. In this case, we allow the contract deployers to launch an arbitration against suspicious state updates by posting a <code>ArbitrationRequest</code> on chain within limited time window. The gatekeepers will keep listening to such requests and assign extra workers for re-execution and validation. If the state update is proved to be wrong, gatekeepers will vote for the right final state and slash the malicious workers.</p>
</blockquote>
<h4 id="state-decryption">State Decryption</h4>
<p>Since the <code>pRuntime</code> of worker receive the <code>ContractKey</code> from gatekeepers during contract deployment, and it&rsquo;s used to recover <code>IdentityKey</code>, <code>EcdhKey</code>, and <code>StorageKey</code>, it can decrypt any key-value pairs of the contract in trie. Noted that the usage of <code>ContractKey</code> for decryption is totally managed by <code>pRuntime</code>, and only contract code in WASM interpreter in <code>pRuntime</code> can access the plaintext.</p>
<p>When a worker tries to resume the execution of a contract, it first needs to fetch the latest state of a contract from blockchain. We can fetch all key-value pairs for now.</p>
<blockquote>
<p><strong>[Improvement]</strong></p>
<p>Introduce cache mechanism. The cache mechanisms, such as the one based on locality of FIFO, can be chosen after we evaluate the common access pattern of contracts in pre-mainnet. Also, we can allow the developers to choose the most appropriate way.</p>
</blockquote>
<p>Since the contract state is stored with timestamp, the worker only needs to replay the transactions after that.</p>
<blockquote>
<p><strong>[Improvement]</strong></p>
<h2 id="contractkey-rotation"><code>ContractKey</code> Rotation</h2>
<p>The key rotation mechanism of Phala Network is crucial to the security and confidentiality of smart contracts. By combining the random assignment of contracts and key rotation, Phala Network is able to defend known advanced attacks against Intel SGX since attackers have to locate the target and leak the secret within limited time window. Also, forward secrecy is promised with rotation mechanism even if some secrets are leaked.</p>
<h3 id="key-rotation">Key Rotation</h3>
<p>In the pre-mainnet of Phala Network, the <code>MasterKey</code> and <code>ContractKey</code> are bound, and any <code>ContractKey</code> can be generated on-the-fly given the <code>MasterKey</code> and according <code>ContractInfo</code>. While in key rotation, we detach the mapping between <code>MasterKey</code> and <code>ContractKey</code> and rotate them separately. That is, <code>ContractKey</code> is rotated after certain epoch by increasing the sequence number in key generation. After the <code>ContractKey</code> is generated by <code>MasterKey</code>, it is stored in the gatekeepers and will not be affected by the following rotation of <code>MasterKey</code>. The gatekeepers keep a certain number of the latest <code>ContractKey</code>s and rotate the <code>MasterKey</code> after certain time interval.</p>
<p>The detach of <code>MasterKey</code> and <code>ContractKey</code> means that historical <code>ContractKey</code>s cannot be re-generated after the rotation of <code>MasterKey</code>, thus ensuring forward secrecy, while this also requires extra mechanism to ensure the availability of <code>ContractKey</code> list: a re-election of gatekeepers and the backup of the <code>ContractKey</code> list is immediately triggered if 1/3 of the gatekeepers are down.</p>
<h3 id="performance-optimization-for-masterkey-rotation">Performance Optimization for <code>MasterKey</code> Rotation</h3>
<p>Since <code>MasterKey</code> is distribution key, the rotation of <code>MasterKey</code> requires several rounds of communication between gatekeepers, thus can be expensive. By leveraging the homomorphism property, such cost can be greatly reduced. For example, one of the most widely-used DKG algorithm is <a href="https://en.wikipedia.org/wiki/Shamir%27s_Secret_Sharing">Shamir&rsquo;s Secret Sharing</a>, and it has been proved to be <a href="http://www.cs.cornell.edu/courses/cs754/2001fa/homo.pdf">(+, +)-homomorphic</a> in 1998. This means we can rotate the Shamir&rsquo;s secrets without any communication between gatekeepers under proper design.</p>
<h3 id="rolling-re-encryption-of-contract-states">Rolling Re-encryption of Contract States</h3>
<p>The rotation of <code>ContractKey</code> requires the regular re-encryption of contract states. To minimize the performance impact of state re-encryption, we try to amortize the cost into epochs. That is, the key-values pairs of contracts are encrypted with the <code>ContractKey</code> of current epoch. Workers can get the historical <code>ContractKey</code>s from the key list of gatekeepers. After certain number of epochs (e.g., 1000 epochs), only the untouched key-value pairs encrypted with outdated <code>ContractKey</code>s need to be re-encrypted.</p>
</blockquote>

    <div class="pager pager_lean">
  <div class="pager_item prev">
    
      
    
  </div>

  <div class="pager_item next">
  
    
  
        
  
    </div>
</div>
<svg width="0" height="0" class="hidden">
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 492.004 492.004" id="next">
    <path d="M484.14 226.886L306.46 49.202c-5.072-5.072-11.832-7.856-19.04-7.856-7.216 0-13.972 2.788-19.044 7.856l-16.132 16.136c-5.068 5.064-7.86 11.828-7.86 19.04 0 7.208 2.792 14.2 7.86 19.264L355.9 207.526H26.58C11.732 207.526 0 219.15 0 234.002v22.812c0 14.852 11.732 27.648 26.58 27.648h330.496L252.248 388.926c-5.068 5.072-7.86 11.652-7.86 18.864 0 7.204 2.792 13.88 7.86 18.948l16.132 16.084c5.072 5.072 11.828 7.836 19.044 7.836 7.208 0 13.968-2.8 19.04-7.872l177.68-177.68c5.084-5.088 7.88-11.88 7.86-19.1.016-7.244-2.776-14.04-7.864-19.12z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 511.999 511.999" id="search">
    <path d="M508.874 478.708L360.142 329.976c28.21-34.827 45.191-79.103 45.191-127.309C405.333 90.917 314.416 0 202.666 0S0 90.917 0 202.667s90.917 202.667 202.667 202.667c48.206 0 92.482-16.982 127.309-45.191l148.732 148.732c4.167 4.165 10.919 4.165 15.086 0l15.081-15.082c4.165-4.166 4.165-10.92-.001-15.085zM202.667 362.667c-88.229 0-160-71.771-160-160s71.771-160 160-160 160 71.771 160 160-71.771 160-160 160z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 241 179" id="harmburger">
    <path d="M1 10C1 4.477 5.477 0 11 0h220c5.523 0 10 4.477 10 10s-4.477 10-10 10H11C5.477 20 1 15.523 1 10zm0 80c0-5.523 4.477-10 10-10h220c5.523 0 10 4.477 10 10s-4.477 10-10 10H11c-5.523 0-10-4.477-10-10zm9 69c-5.523 0-10 4.477-10 10s4.477 10 10 10h220c5.523 0 10-4.477 10-10s-4.477-10-10-10H10z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 401.998 401.998" id="sort">
    <path d="M73.092 164.452h255.813c4.949 0 9.233-1.807 12.848-5.424 3.613-3.616 5.427-7.898 5.427-12.847s-1.813-9.229-5.427-12.85L213.846 5.424C210.232 1.812 205.951 0 200.999 0s-9.233 1.812-12.85 5.424L60.242 133.331c-3.617 3.617-5.424 7.901-5.424 12.85 0 4.948 1.807 9.231 5.424 12.847 3.621 3.617 7.902 5.424 12.85 5.424zm255.813 73.097H73.092c-4.952 0-9.233 1.808-12.85 5.421-3.617 3.617-5.424 7.898-5.424 12.847s1.807 9.233 5.424 12.848L188.149 396.57c3.621 3.617 7.902 5.428 12.85 5.428s9.233-1.811 12.847-5.428l127.907-127.906c3.613-3.614 5.427-7.898 5.427-12.848 0-4.948-1.813-9.229-5.427-12.847-3.614-3.616-7.899-5.42-12.848-5.42z"></path>
  </symbol>
</svg>

<svg width="0" height="0" class="hidden">
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="facebook">
    <path d="M437 0H75C33.648 0 0 33.648 0 75v362c0 41.352 33.648 75 75 75h151V331h-60v-90h60v-61c0-49.629 40.371-90 90-90h91v90h-91v61h91l-15 90h-76v181h121c41.352 0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zm0 0"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18.001 18.001" id="twitter">
    <path d="M15.891 4.013c.808-.496 1.343-1.173 1.605-2.034a8.68 8.68 0 0 1-2.351.861c-.703-.756-1.593-1.14-2.66-1.14-1.043 0-1.924.366-2.643 1.078a3.56 3.56 0 0 0-1.076 2.605c0 .309.039.585.117.819-3.076-.105-5.622-1.381-7.628-3.837-.34.601-.51 1.213-.51 1.846 0 1.301.549 2.332 1.645 3.089-.625-.053-1.176-.211-1.645-.47 0 .929.273 1.705.82 2.388a3.623 3.623 0 0 0 2.115 1.291c-.312.08-.641.118-.979.118-.312 0-.533-.026-.664-.083.23.757.664 1.371 1.291 1.841a3.652 3.652 0 0 0 2.152.743C4.148 14.173 2.625 14.69.902 14.69c-.422 0-.721-.006-.902-.038 1.697 1.102 3.586 1.649 5.676 1.649 2.139 0 4.029-.542 5.674-1.626 1.645-1.078 2.859-2.408 3.639-3.974a10.77 10.77 0 0 0 1.172-4.892v-.468a7.788 7.788 0 0 0 1.84-1.921 8.142 8.142 0 0 1-2.11.593z"
      ></path>
  </symbol>
  <symbol aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="mail">
    <path  d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="calendar">
    <path d="M452 40h-24V0h-40v40H124V0H84v40H60C26.916 40 0 66.916 0 100v352c0 33.084 26.916 60 60 60h392c33.084 0 60-26.916 60-60V100c0-33.084-26.916-60-60-60zm20 412c0 11.028-8.972 20-20 20H60c-11.028 0-20-8.972-20-20V188h432v264zm0-304H40v-48c0-11.028 8.972-20 20-20h24v40h40V80h264v40h40V80h24c11.028 0 20 8.972 20 20v48z"></path>
    <path d="M76 230h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 310h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 390h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80-80h40v40h-40z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="github">
    <path d="M255.968 5.329C114.624 5.329 0 120.401 0 262.353c0 113.536 73.344 209.856 175.104 243.872 12.8 2.368 17.472-5.568 17.472-12.384 0-6.112-.224-22.272-.352-43.712-71.2 15.52-86.24-34.464-86.24-34.464-11.616-29.696-28.416-37.6-28.416-37.6-23.264-15.936 1.728-15.616 1.728-15.616 25.696 1.824 39.2 26.496 39.2 26.496 22.848 39.264 59.936 27.936 74.528 21.344 2.304-16.608 8.928-27.936 16.256-34.368-56.832-6.496-116.608-28.544-116.608-127.008 0-28.064 9.984-51.008 26.368-68.992-2.656-6.496-11.424-32.64 2.496-68 0 0 21.504-6.912 70.4 26.336 20.416-5.696 42.304-8.544 64.096-8.64 21.728.128 43.648 2.944 64.096 8.672 48.864-33.248 70.336-26.336 70.336-26.336 13.952 35.392 5.184 61.504 2.56 68 16.416 17.984 26.304 40.928 26.304 68.992 0 98.72-59.84 120.448-116.864 126.816 9.184 7.936 17.376 23.616 17.376 47.584 0 34.368-.32 62.08-.32 70.496 0 6.88 4.608 14.88 17.6 12.352C438.72 472.145 512 375.857 512 262.353 512 120.401 397.376 5.329 255.968 5.329z"></path>
  </symbol>
  <symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="rss">
    <circle cx="3.429" cy="20.571" r="3.429"></circle>
    <path d="M11.429 24h4.57C15.999 15.179 8.821 8.001 0 8v4.572c6.302.001 11.429 5.126 11.429 11.428z"></path>
    <path d="M24 24C24 10.766 13.234 0 0 0v4.571c10.714 0 19.43 8.714 19.43 19.429z"></path>
  </symbol>
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="linkedin">
    <path d="M437 0H75C33.648 0 0 33.648 0 75v362c0 41.352 33.648 75 75 75h362c41.352 0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zM181 406h-60V196h60zm0-240h-60v-60h60zm210 240h-60V286c0-16.54-13.46-30-30-30s-30 13.46-30 30v120h-60V196h60v11.309C286.719 202.422 296.93 196 316 196c40.691.043 75 36.547 75 79.688zm0 0"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 612 612" id="arrow">
    <path d="M604.501 440.509L325.398 134.956c-5.331-5.357-12.423-7.627-19.386-7.27-6.989-.357-14.056 1.913-19.387 7.27L7.499 440.509c-9.999 10.024-9.999 26.298 0 36.323s26.223 10.024 36.222 0l262.293-287.164L568.28 476.832c9.999 10.024 26.222 10.024 36.221 0 9.999-10.023 9.999-26.298 0-36.323z"></path>
  </symbol>
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="carly">
    <path d="M504.971 239.029L448 182.059V84c0-46.317-37.682-84-84-84h-44c-13.255 0-24 10.745-24 24s10.745 24 24 24h44c19.851 0 36 16.149 36 36v108c0 6.365 2.529 12.47 7.029 16.971L454.059 256l-47.029 47.029A24.002 24.002 0 0 0 400 320v108c0 19.851-16.149 36-36 36h-44c-13.255 0-24 10.745-24 24s10.745 24 24 24h44c46.318 0 84-37.683 84-84v-98.059l56.971-56.971c9.372-9.372 9.372-24.568 0-33.941zM112 192V84c0-19.851 16.149-36 36-36h44c13.255 0 24-10.745 24-24S205.255 0 192 0h-44c-46.318 0-84 37.683-84 84v98.059l-56.971 56.97c-9.373 9.373-9.373 24.568 0 33.941L64 329.941V428c0 46.317 37.682 84 84 84h44c13.255 0 24-10.745 24-24s-10.745-24-24-24h-44c-19.851 0-36-16.149-36-36V320c0-6.365-2.529-12.47-7.029-16.971L57.941 256l47.029-47.029A24.002 24.002 0 0 0 112 192z"></path>
  </symbol>
  <symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="copy">
    <path d="M23 2.75A2.75 2.75 0 0 0 20.25 0H8.75A2.75 2.75 0 0 0 6 2.75v13.5A2.75 2.75 0 0 0 8.75 19h11.5A2.75 2.75 0 0 0 23 16.25zM18.25 14.5h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5zm0-3h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5zm0-3h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5z"></path>
    <path d="M8.75 20.5a4.255 4.255 0 0 1-4.25-4.25V2.75c0-.086.02-.166.025-.25H3.75A2.752 2.752 0 0 0 1 5.25v16A2.752 2.752 0 0 0 3.75 24h12a2.752 2.752 0 0 0 2.75-2.75v-.75z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512.001 512.001" id="closeme">
    <path d="M284.286 256.002L506.143 34.144c7.811-7.811 7.811-20.475 0-28.285-7.811-7.81-20.475-7.811-28.285 0L256 227.717 34.143 5.859c-7.811-7.811-20.475-7.811-28.285 0-7.81 7.811-7.811 20.475 0 28.285l221.857 221.857L5.858 477.859c-7.811 7.811-7.811 20.475 0 28.285a19.938 19.938 0 0 0 14.143 5.857 19.94 19.94 0 0 0 14.143-5.857L256 284.287l221.857 221.857c3.905 3.905 9.024 5.857 14.143 5.857s10.237-1.952 14.143-5.857c7.811-7.811 7.811-20.475 0-28.285L284.286 256.002z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="open-menu">
    <path d="M492 236H20c-11.046 0-20 8.954-20 20s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20zm0-160H20C8.954 76 0 84.954 0 96s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20zm0 320H20c-11.046 0-20 8.954-20 20s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="instagram">
    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="youtube">
    <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="stackoverflow">
    <path d="M21 27v-8h3v11H0V19h3v8h18z"></path><path d="M17.1.2L15 1.8l7.9 10.6 2.1-1.6L17.1.2zm3.7 14.7L10.6 6.4l1.7-2 10.2 8.5-1.7 2zM7.2 12.3l12 5.6 1.1-2.4-12-5.6-1.1 2.4zm-1.8 6.8l13.56 1.96.17-2.38-13.26-2.55-.47 2.97zM19 25H5v-3h14v3z"></path>
  </symbol>
</svg>

  </main>
</div>

  </div>
<footer class="pt-2 pb-2">
  <div class="wrap">
    <p>&copy; <span class="year">2021</span></p>
  </div>
</footer>


<svg width="0" height="0" class="hidden">
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 492.004 492.004" id="next">
    <path d="M484.14 226.886L306.46 49.202c-5.072-5.072-11.832-7.856-19.04-7.856-7.216 0-13.972 2.788-19.044 7.856l-16.132 16.136c-5.068 5.064-7.86 11.828-7.86 19.04 0 7.208 2.792 14.2 7.86 19.264L355.9 207.526H26.58C11.732 207.526 0 219.15 0 234.002v22.812c0 14.852 11.732 27.648 26.58 27.648h330.496L252.248 388.926c-5.068 5.072-7.86 11.652-7.86 18.864 0 7.204 2.792 13.88 7.86 18.948l16.132 16.084c5.072 5.072 11.828 7.836 19.044 7.836 7.208 0 13.968-2.8 19.04-7.872l177.68-177.68c5.084-5.088 7.88-11.88 7.86-19.1.016-7.244-2.776-14.04-7.864-19.12z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 511.999 511.999" id="search">
    <path d="M508.874 478.708L360.142 329.976c28.21-34.827 45.191-79.103 45.191-127.309C405.333 90.917 314.416 0 202.666 0S0 90.917 0 202.667s90.917 202.667 202.667 202.667c48.206 0 92.482-16.982 127.309-45.191l148.732 148.732c4.167 4.165 10.919 4.165 15.086 0l15.081-15.082c4.165-4.166 4.165-10.92-.001-15.085zM202.667 362.667c-88.229 0-160-71.771-160-160s71.771-160 160-160 160 71.771 160 160-71.771 160-160 160z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 241 179" id="harmburger">
    <path d="M1 10C1 4.477 5.477 0 11 0h220c5.523 0 10 4.477 10 10s-4.477 10-10 10H11C5.477 20 1 15.523 1 10zm0 80c0-5.523 4.477-10 10-10h220c5.523 0 10 4.477 10 10s-4.477 10-10 10H11c-5.523 0-10-4.477-10-10zm9 69c-5.523 0-10 4.477-10 10s4.477 10 10 10h220c5.523 0 10-4.477 10-10s-4.477-10-10-10H10z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 401.998 401.998" id="sort">
    <path d="M73.092 164.452h255.813c4.949 0 9.233-1.807 12.848-5.424 3.613-3.616 5.427-7.898 5.427-12.847s-1.813-9.229-5.427-12.85L213.846 5.424C210.232 1.812 205.951 0 200.999 0s-9.233 1.812-12.85 5.424L60.242 133.331c-3.617 3.617-5.424 7.901-5.424 12.85 0 4.948 1.807 9.231 5.424 12.847 3.621 3.617 7.902 5.424 12.85 5.424zm255.813 73.097H73.092c-4.952 0-9.233 1.808-12.85 5.421-3.617 3.617-5.424 7.898-5.424 12.847s1.807 9.233 5.424 12.848L188.149 396.57c3.621 3.617 7.902 5.428 12.85 5.428s9.233-1.811 12.847-5.428l127.907-127.906c3.613-3.614 5.427-7.898 5.427-12.848 0-4.948-1.813-9.229-5.427-12.847-3.614-3.616-7.899-5.42-12.848-5.42z"></path>
  </symbol>
</svg>

<svg width="0" height="0" class="hidden">
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="facebook">
    <path d="M437 0H75C33.648 0 0 33.648 0 75v362c0 41.352 33.648 75 75 75h151V331h-60v-90h60v-61c0-49.629 40.371-90 90-90h91v90h-91v61h91l-15 90h-76v181h121c41.352 0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zm0 0"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18.001 18.001" id="twitter">
    <path d="M15.891 4.013c.808-.496 1.343-1.173 1.605-2.034a8.68 8.68 0 0 1-2.351.861c-.703-.756-1.593-1.14-2.66-1.14-1.043 0-1.924.366-2.643 1.078a3.56 3.56 0 0 0-1.076 2.605c0 .309.039.585.117.819-3.076-.105-5.622-1.381-7.628-3.837-.34.601-.51 1.213-.51 1.846 0 1.301.549 2.332 1.645 3.089-.625-.053-1.176-.211-1.645-.47 0 .929.273 1.705.82 2.388a3.623 3.623 0 0 0 2.115 1.291c-.312.08-.641.118-.979.118-.312 0-.533-.026-.664-.083.23.757.664 1.371 1.291 1.841a3.652 3.652 0 0 0 2.152.743C4.148 14.173 2.625 14.69.902 14.69c-.422 0-.721-.006-.902-.038 1.697 1.102 3.586 1.649 5.676 1.649 2.139 0 4.029-.542 5.674-1.626 1.645-1.078 2.859-2.408 3.639-3.974a10.77 10.77 0 0 0 1.172-4.892v-.468a7.788 7.788 0 0 0 1.84-1.921 8.142 8.142 0 0 1-2.11.593z"
      ></path>
  </symbol>
  <symbol aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="mail">
    <path  d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="calendar">
    <path d="M452 40h-24V0h-40v40H124V0H84v40H60C26.916 40 0 66.916 0 100v352c0 33.084 26.916 60 60 60h392c33.084 0 60-26.916 60-60V100c0-33.084-26.916-60-60-60zm20 412c0 11.028-8.972 20-20 20H60c-11.028 0-20-8.972-20-20V188h432v264zm0-304H40v-48c0-11.028 8.972-20 20-20h24v40h40V80h264v40h40V80h24c11.028 0 20 8.972 20 20v48z"></path>
    <path d="M76 230h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 310h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 390h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80-80h40v40h-40z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="github">
    <path d="M255.968 5.329C114.624 5.329 0 120.401 0 262.353c0 113.536 73.344 209.856 175.104 243.872 12.8 2.368 17.472-5.568 17.472-12.384 0-6.112-.224-22.272-.352-43.712-71.2 15.52-86.24-34.464-86.24-34.464-11.616-29.696-28.416-37.6-28.416-37.6-23.264-15.936 1.728-15.616 1.728-15.616 25.696 1.824 39.2 26.496 39.2 26.496 22.848 39.264 59.936 27.936 74.528 21.344 2.304-16.608 8.928-27.936 16.256-34.368-56.832-6.496-116.608-28.544-116.608-127.008 0-28.064 9.984-51.008 26.368-68.992-2.656-6.496-11.424-32.64 2.496-68 0 0 21.504-6.912 70.4 26.336 20.416-5.696 42.304-8.544 64.096-8.64 21.728.128 43.648 2.944 64.096 8.672 48.864-33.248 70.336-26.336 70.336-26.336 13.952 35.392 5.184 61.504 2.56 68 16.416 17.984 26.304 40.928 26.304 68.992 0 98.72-59.84 120.448-116.864 126.816 9.184 7.936 17.376 23.616 17.376 47.584 0 34.368-.32 62.08-.32 70.496 0 6.88 4.608 14.88 17.6 12.352C438.72 472.145 512 375.857 512 262.353 512 120.401 397.376 5.329 255.968 5.329z"></path>
  </symbol>
  <symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="rss">
    <circle cx="3.429" cy="20.571" r="3.429"></circle>
    <path d="M11.429 24h4.57C15.999 15.179 8.821 8.001 0 8v4.572c6.302.001 11.429 5.126 11.429 11.428z"></path>
    <path d="M24 24C24 10.766 13.234 0 0 0v4.571c10.714 0 19.43 8.714 19.43 19.429z"></path>
  </symbol>
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="linkedin">
    <path d="M437 0H75C33.648 0 0 33.648 0 75v362c0 41.352 33.648 75 75 75h362c41.352 0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zM181 406h-60V196h60zm0-240h-60v-60h60zm210 240h-60V286c0-16.54-13.46-30-30-30s-30 13.46-30 30v120h-60V196h60v11.309C286.719 202.422 296.93 196 316 196c40.691.043 75 36.547 75 79.688zm0 0"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 612 612" id="arrow">
    <path d="M604.501 440.509L325.398 134.956c-5.331-5.357-12.423-7.627-19.386-7.27-6.989-.357-14.056 1.913-19.387 7.27L7.499 440.509c-9.999 10.024-9.999 26.298 0 36.323s26.223 10.024 36.222 0l262.293-287.164L568.28 476.832c9.999 10.024 26.222 10.024 36.221 0 9.999-10.023 9.999-26.298 0-36.323z"></path>
  </symbol>
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="carly">
    <path d="M504.971 239.029L448 182.059V84c0-46.317-37.682-84-84-84h-44c-13.255 0-24 10.745-24 24s10.745 24 24 24h44c19.851 0 36 16.149 36 36v108c0 6.365 2.529 12.47 7.029 16.971L454.059 256l-47.029 47.029A24.002 24.002 0 0 0 400 320v108c0 19.851-16.149 36-36 36h-44c-13.255 0-24 10.745-24 24s10.745 24 24 24h44c46.318 0 84-37.683 84-84v-98.059l56.971-56.971c9.372-9.372 9.372-24.568 0-33.941zM112 192V84c0-19.851 16.149-36 36-36h44c13.255 0 24-10.745 24-24S205.255 0 192 0h-44c-46.318 0-84 37.683-84 84v98.059l-56.971 56.97c-9.373 9.373-9.373 24.568 0 33.941L64 329.941V428c0 46.317 37.682 84 84 84h44c13.255 0 24-10.745 24-24s-10.745-24-24-24h-44c-19.851 0-36-16.149-36-36V320c0-6.365-2.529-12.47-7.029-16.971L57.941 256l47.029-47.029A24.002 24.002 0 0 0 112 192z"></path>
  </symbol>
  <symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="copy">
    <path d="M23 2.75A2.75 2.75 0 0 0 20.25 0H8.75A2.75 2.75 0 0 0 6 2.75v13.5A2.75 2.75 0 0 0 8.75 19h11.5A2.75 2.75 0 0 0 23 16.25zM18.25 14.5h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5zm0-3h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5zm0-3h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5z"></path>
    <path d="M8.75 20.5a4.255 4.255 0 0 1-4.25-4.25V2.75c0-.086.02-.166.025-.25H3.75A2.752 2.752 0 0 0 1 5.25v16A2.752 2.752 0 0 0 3.75 24h12a2.752 2.752 0 0 0 2.75-2.75v-.75z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512.001 512.001" id="closeme">
    <path d="M284.286 256.002L506.143 34.144c7.811-7.811 7.811-20.475 0-28.285-7.811-7.81-20.475-7.811-28.285 0L256 227.717 34.143 5.859c-7.811-7.811-20.475-7.811-28.285 0-7.81 7.811-7.811 20.475 0 28.285l221.857 221.857L5.858 477.859c-7.811 7.811-7.811 20.475 0 28.285a19.938 19.938 0 0 0 14.143 5.857 19.94 19.94 0 0 0 14.143-5.857L256 284.287l221.857 221.857c3.905 3.905 9.024 5.857 14.143 5.857s10.237-1.952 14.143-5.857c7.811-7.811 7.811-20.475 0-28.285L284.286 256.002z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="open-menu">
    <path d="M492 236H20c-11.046 0-20 8.954-20 20s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20zm0-160H20C8.954 76 0 84.954 0 96s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20zm0 320H20c-11.046 0-20 8.954-20 20s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="instagram">
    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="youtube">
    <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="stackoverflow">
    <path d="M21 27v-8h3v11H0V19h3v8h18z"></path><path d="M17.1.2L15 1.8l7.9 10.6 2.1-1.6L17.1.2zm3.7 14.7L10.6 6.4l1.7-2 10.2 8.5-1.7 2zM7.2 12.3l12 5.6 1.1-2.4-12-5.6-1.1 2.4zm-1.8 6.8l13.56 1.96.17-2.38-13.26-2.55-.47 2.97zM19 25H5v-3h14v3z"></path>
  </symbol>
</svg>

<script src="https://wiki.phala.network/js/bundle.min.ff2af2b02cda8c10a3c000abaddf6495f5de9e097c4305d94d77eaf30b472f1332958cf308695a20408e459815f3641bb83ca163fea06b3d4468c3de30dfb189.js"></script>

</body>
</html>
