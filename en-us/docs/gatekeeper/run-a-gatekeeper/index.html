<!doctype html>
<html lang="en-us">
<head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1"><meta name="generator" content="Hugo 0.76.4" />
<link rel="apple-touch-icon" sizes="180x180" href='https://wiki.phala.network/favicons/apple-touch-icon.png'>
<link rel="icon" type="image/png" sizes="32x32" href='https://wiki.phala.network/favicons/favicon-32x32.png'>
<link rel="icon" type="image/png" sizes="16x16" href='https://wiki.phala.network/favicons/favicon-16x16.png'>
<link rel="manifest" href='https://wiki.phala.network/favicons/site.webmanifest'>
<link rel="mask-icon" href='https://wiki.phala.network/favicons/safari-pinned-tab.svg'  color="#004750">
<link rel="shortcut icon" href='https://wiki.phala.network/favicons/favicon.ico'>
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-config" content='https://wiki.phala.network/favicons/browserconfig.xml'>
<meta name="theme-color" content="#ffffff">

<title>Run a Gatekeeper | Phala Network Wiki</title><meta property="og:title" content="Run a Gatekeeper" />
<meta property="og:description" content="Setup Environment   Hardware
 CPU: 6th generation or newer Intel Core/Pentium/Celeron/Atom series. Memory: 2GB - 8GB. 2GB is indeed the minimum memory you should operate your Gatekeeper with. For better performance, you can bump it up to 4GB or 8GB, but memory more than that is unnecessary. In order to compile the binary yourself, you will need around 8GB memory. Mainboard: SGX-supported mainboard, and newer mainboards can support more SGX features." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://wiki.phala.network/en-us/docs/gatekeeper/run-a-gatekeeper/" />
<meta property="article:published_time" content="2020-07-10T01:16:05+08:00" />
<meta property="article:modified_time" content="2020-07-10T01:16:05+08:00" /><meta property="og:site_name" content="Phala Network Wiki" />
<meta itemprop="name" content="Run a Gatekeeper">
<meta itemprop="description" content="Setup Environment   Hardware
 CPU: 6th generation or newer Intel Core/Pentium/Celeron/Atom series. Memory: 2GB - 8GB. 2GB is indeed the minimum memory you should operate your Gatekeeper with. For better performance, you can bump it up to 4GB or 8GB, but memory more than that is unnecessary. In order to compile the binary yourself, you will need around 8GB memory. Mainboard: SGX-supported mainboard, and newer mainboards can support more SGX features.">
<meta itemprop="datePublished" content="2020-07-10T01:16:05+08:00" />
<meta itemprop="dateModified" content="2020-07-10T01:16:05+08:00" />
<meta itemprop="wordCount" content="1923">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Run a Gatekeeper"/>
<meta name="twitter:description" content="Setup Environment   Hardware
 CPU: 6th generation or newer Intel Core/Pentium/Celeron/Atom series. Memory: 2GB - 8GB. 2GB is indeed the minimum memory you should operate your Gatekeeper with. For better performance, you can bump it up to 4GB or 8GB, but memory more than that is unnecessary. In order to compile the binary yourself, you will need around 8GB memory. Mainboard: SGX-supported mainboard, and newer mainboards can support more SGX features."/>


<link rel="stylesheet" href="https://wiki.phala.network/css/styles.389b7e61094f0df549d34528f889ee0fda81e7745b6ff7dde5d04ebc18553959a2276b4064651cca0d8f490d9f28ce63224c551ffcfb0b70b3db8f5dedbcd82c.css" integrity="sha512-OJt&#43;YQlPDfVJ00Uo&#43;InuD9qB53Rbb/fd5dBOvBhVOVmiJ2tAZGUcyg2PSQ2fKM5jIkxVH/z7C3Cz249d7bzYLA==">


  
  
    
    
    
    
  
    
    
    
    
  
  
  <link href="//fonts.googleapis.com/css?family=Recursive:300,400,500,600|Lato:300,400,500,600" rel="stylesheet">

</head>
<body class="page-page">
  <header class="nav_header"><nav class="wrap nav">
	<a href="https://wiki.phala.network" class="nav_brand">
		<picture>
			
			<img srcset = 'https://wiki.phala.network/images/logo-phala-48.png' alt = 'Phala Network Wiki Logo'>
		</picture>
		<label class="nav_toggle">Menu</label>
	</a>
	<ul class="nav_body">
		<li class="nav-item">
<div class="search">
  <label for="find" class="search_label"><svg class="icon">
  <use xlink:href="#search"></use>
</svg>
  </label>
  <input type="search" class="search_field" placeholder="" id="find" autocomplete="off">
  <div class="search_results"></div>
</div>



		</li>
		<li class="nav-item">
			<a class="nav-link" href="https://wiki.phala.network/en-us/docs/"><span>Docs</span></a>
		</li>
		<li class="nav-item">
			<a class="nav-link" href="https://wiki.phala.network/zh-cn/"><span>中文站</span></a>
		</li>
		<li class="nav-item">
			<a class="nav-link" href="https://phala.network"><span>Homepage</span></a>
		</li>
		
		<li class="nav-item">
			<a class="nav-link" href="https://github.com/Phala-Network/phala-wiki/" target="_blank">GitHub</a>
		</li>
		<li class="nav-item"><div class = 'color_mode'>
  <label for = 'mode'></label>
  <input type = 'checkbox' class = 'color_choice' id = 'mode' title="Toggle Dark Mode">
</div>
</li>
	</ul>
</nav>

  </header>
  <main class="main wrap pt-4"><div class="grid-auto">
  <div><aside class="aside">
  <section class="section">
    <h2 class="section_title"><a  href="https://wiki.phala.network/en-us/docs/" class="group">Overview</a></h2>
      <section class="subsection" id="docs-overview">
  <section class="section">
    <h2 class="section_title"><a  href="https://wiki.phala.network/en-us/docs/developer/" class="group">Contract Development Tutorial</a></h2>
      <section class="subsection" id="docs-contract-development-tutorial">
        <h3 class="section_link"><a id="docs-11-run-a-local-development-network" href="https://wiki.phala.network/en-us/docs/developer/run-a-local-development-network/">1.1 Run a Local Development Network</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#environment">Environment</a></li>
    <li><a href="#build-the-core-blockchain">Build the core blockchain</a></li>
    <li><a href="#build-the-web-ui">Build the Web UI</a></li>
    <li><a href="#send-some-secret-tokens">Send some secret tokens</a></li>
    <li><a href="#conclusion">Conclusion</a>
      <ul>
        <li><a href="#submit-your-work">Submit your work</a></li>
      </ul>
    </li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-12-hello-world-your-first-confidential-contract" href="https://wiki.phala.network/en-us/docs/developer/your-first-confidential-contract/">1.2 Hello World: your first confidential contract</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#environment-and-build">Environment and Build</a></li>
    <li><a href="#walk-through">Walk-through</a>
      <ul>
        <li><a href="#contract">Contract</a></li>
        <li><a href="#frontend">Frontend</a></li>
      </ul>
    </li>
    <li><a href="#implement-a-secret-notebook">Implement a secret notebook</a>
      <ul>
        <li><a href="#contract-1">Contract</a></li>
        <li><a href="#frontend-1">Frontend</a></li>
      </ul>
    </li>
    <li><a href="#put-everything-together">Put everything together</a></li>
    <li><a href="#summary">Summary</a>
      <ul>
        <li><a href="#submit-your-work">Submit your work</a></li>
      </ul>
    </li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-13-troubleshooting" href="https://wiki.phala.network/en-us/docs/developer/troubleshooting/">1.3 Troubleshooting</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#phala-blockchain"><code>phala-blockchain</code></a>
      <ul>
        <li><a href="#probelm-consider-giving-accuracy-a-type-when-building-substrate">Probelm: &quot;consider giving <code>accuracy</code> a type&quot; when building substrate</a></li>
        <li><a href="#probelm-duplicate-lang-item">Probelm: &quot;duplicate lang item&quot;</a></li>
      </ul>
    </li>
    <li><a href="#apps-ng-related"><code>apps-ng</code> related</a>
      <ul>
        <li><a href="#probelm-polkadotdevconfigtsconfig-not-found">Probelm: '@polkadot/dev/config/tsconfig' not found</a></li>
      </ul>
    </li>
  </ul>
</nav>
      </section>
  </section>
  <section class="section">
    <h2 class="section_title"><a  href="https://wiki.phala.network/en-us/docs/gatekeeper/" class="group">GateKeeper Guide</a></h2>
      <section class="subsection" id="docs-gatekeeper-guide">
        <h3 class="section_link active"><a id="docs-run-a-gatekeeper" href="https://wiki.phala.network/en-us/docs/gatekeeper/run-a-gatekeeper/">Run a Gatekeeper</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#setup-environment">Setup Environment</a></li>
    <li><a href="#synchronize-chain-data">Synchronize Chain Data</a>
      <ul>
        <li><a href="#to-compile-your-gatekeeper-node">*To Compile Your Gatekeeper Node</a></li>
      </ul>
    </li>
    <li><a href="#bond-pha">Bond PHA</a></li>
    <li><a href="#set-session-keys">Set Session Keys</a>
      <ul>
        <li><a href="#generating-the-session-keys">Generating the Session Keys</a>
          <ul>
            <li><a href="#option-1-polkadotjs-apps">Option 1: PolkadotJS-APPS</a></li>
            <li><a href="#option-2-cli">Option 2: CLI</a></li>
          </ul>
        </li>
        <li><a href="#set-your-sessions-keys">Set Your Sessions Keys</a></li>
      </ul>
    </li>
    <li><a href="#pruntime-setup">pRuntime Setup</a></li>
    <li><a href="#phost-setup">pHost Setup</a></li>
    <li><a href="#validate-your-gatekeeper">Validate Your Gatekeeper</a>
      <ul>
        <li><a href="#miner-community">Miner Community</a></li>
      </ul>
    </li>
  </ul>
</nav>
      </section>
  </section>
  <section class="section">
    <h2 class="section_title"><a  href="https://wiki.phala.network/en-us/docs/poc3/" class="group">PoC-3 Vendetta Mining Guide</a></h2>
      <section class="subsection" id="docs-poc-3-vendetta-mining-guide">
        <h3 class="section_link"><a id="docs-11-hardware-requirement-and-configuration" href="https://wiki.phala.network/en-us/docs/poc3/1-1-hardware-configuration/">1.1 Hardware Requirement and Configuration</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#general-hardware-requirements">General Hardware Requirements</a>
      <ul>
        <li><a href="#cpu-requirement">CPU Requirement</a></li>
        <li><a href="#bios-settings">BIOS Settings</a></li>
      </ul>
    </li>
    <li><a href="#sgx-driver-installation">SGX Driver Installation</a></li>
    <li><a href="#double-check-the-sgx-capability">Double check the SGX capability</a>
      <ul>
        <li>
          <ul>
            <li><a href="#reference">Reference</a></li>
            <li><a href="#miner-community">Miner Community</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-12-software-configuration" href="https://wiki.phala.network/en-us/docs/poc3/1-2-software-configuration/">1.2 Software Configuration</a></h3><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#system-requirement">System Requirement</a></li>
        <li><a href="#install-docker-ce">Install Docker-CE</a></li>
      </ul>
    </li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-13-set-miner-stash" href="https://wiki.phala.network/en-us/docs/poc3/1-3-set-miner-stash/">1.3 Set Miner Stash</a></h3><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#connecting-to-testnet-vendetta">Connecting to Testnet Vendetta</a></li>
        <li><a href="#creating-phala-accounts">Creating Phala Accounts</a></li>
        <li><a href="#obtaining-tpha">Obtaining tPHA</a></li>
        <li><a href="#setting-miner-stash">Setting Miner Stash</a></li>
      </ul>
    </li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-21-deploy-the-full-stack" href="https://wiki.phala.network/en-us/docs/poc3/2-1-deploy-the-full-stack/">2.1 Deploy the Full Stack</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#deploying-phala-full-node">Deploying Phala full-node</a></li>
    <li><a href="#deploying-pruntime">Deploying pRuntime</a></li>
    <li><a href="#deploying-phost">Deploying pHost</a></li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-22-set-commission" href="https://wiki.phala.network/en-us/docs/poc3/2-2-set-commission/">2.2 Set Commission</a></h3><nav id="TableOfContents"></nav>
        <h3 class="section_link"><a id="docs-23-veirfy-the-miner-state" href="https://wiki.phala.network/en-us/docs/poc3/2-3-verify-the-miner-state/">2.3 Veirfy the Miner State</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#mining-state-references">Mining State References</a></li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-31-set-miner-stakes" href="https://wiki.phala.network/en-us/docs/poc3/3-1-set-miner-stakes/">3.1 Set Miner Stakes</a></h3><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#the-mining-lending-protocol">The Mining Lending Protocol</a></li>
      </ul>
    </li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-32-start-mining" href="https://wiki.phala.network/en-us/docs/poc3/3-2-start-mining/">3.2 Start Mining</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#mining-states-verification">Mining States Verification</a></li>
    <li><a href="#mining-status-references">Mining Status References</a></li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-33-stop-mining" href="https://wiki.phala.network/en-us/docs/poc3/3-3-stop-mining/">3.3 Stop Mining</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#miner-state-verification">Miner State Verification</a></li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-34-check-miner-profits" href="https://wiki.phala.network/en-us/docs/poc3/3-4-check-mining-profits/">3.4 Check Miner Profits</a></h3><nav id="TableOfContents"></nav>
        <h3 class="section_link"><a id="docs-35-upgrade-miner" href="https://wiki.phala.network/en-us/docs/poc3/3-5-upgrade-miner/">3.5 Upgrade Miner</a></h3><nav id="TableOfContents">
  <ul>
    <li><a href="#stop-mining">Stop mining</a></li>
    <li><a href="#pull-the-new-docker-image">Pull the new docker image</a></li>
    <li><a href="#bring-up-the-full-stack">Bring up the full stack</a></li>
    <li><a href="#reset-database-for-troubleshooting-only">Reset database (for troubleshooting only)</a>
      <ul>
        <li><a href="#miner-community">Miner Community</a></li>
      </ul>
    </li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-4-frequently-asked-questions" href="https://wiki.phala.network/en-us/docs/poc3/4-faq/">4 Frequently Asked Questions</a></h3><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#miner-community">Miner Community</a></li>
      </ul>
    </li>
    <li><a href="#i-glossary">I. Glossary</a></li>
    <li><a href="#ii-setting-up-multiple-miners">II. Setting up Multiple Miners</a>
      <ul>
        <li><a href="#q-shall-i-set-up-multiple-full-nodes-as-well-if-i-have-several-miner-workers">Q: Shall I set up multiple full-nodes as well if I have several miner workers?</a></li>
        <li><a href="#q-can-i-use-the-same-ip-address-if-i-have-multiple-computer">Q: Can I use the same IP address if I have multiple computer?</a></li>
        <li><a href="#q-is-a-public-internet-ip-address-necessary-and-will-it-gain-more-points-in-mining">Q: Is a public Internet IP address necessary and will it gain more points in mining?</a></li>
        <li><a href="#q-can-i-use-the-same-phala-account-for-multiple-miners">Q: Can I use the same Phala account for multiple miners?</a></li>
        <li><a href="#q-will-there-be-a-solution-to-registering-multiple-miner-accounts-in-a-short-time">Q: Will there be a solution to registering multiple miner accounts in a short time?</a></li>
      </ul>
    </li>
    <li><a href="#iii-linux-updates--sgx-driver">III. Linux Updates &amp; SGX Driver</a>
      <ul>
        <li><a href="#q-got-error-apt-install---fix-broken">Q: Got error: <code>apt install --fix-broken</code></a></li>
        <li><a href="#q-got-error-need-install-curl-">Q: Got error: <code>need install curl </code></a></li>
        <li><a href="#q-it-got-stuck-after-docker-pull-commands">Q: It got stuck after <code>docker pull...</code> commands</a></li>
      </ul>
    </li>
    <li><a href="#iv-issues-related-to-phala-node-pruntime-phost">IV. Issues related to phala-node, pRuntime, pHost</a>
      <ul>
        <li><a href="#q-got-error-no-such-command-after-i-typed-docker-pull-dockerpkggithubcomphala-networkphala-dockerphala-nodepre-test-4">Q: Got error &quot;no such command&quot; after I typed <code>docker pull docker.pkg.github.com/phala-network/phala-docker/phala-node:pre-test-4</code></a></li>
        <li><a href="#q-got-error-permission-denied">Q: Got error <code>permission denied</code></a></li>
        <li><a href="#q-got-error-docker-error-response-from-darmon-conflict-the-container-name-phala-node-is-already-in-use-by-container">Q: Got error <code>docker: Error response from darmon: Conflict. The container name &quot;/phala-node&quot; is already in use by container</code></a></li>
        <li><a href="#q-got-errors-as-blow">Q: Got errors as blow:</a></li>
        <li><a href="#q-got-error-devsgxenclave-no-such-file-or-directory-or-devisgx-no-such-file-or-directory">Q: Got error: <code>/dev/sgx/enclave No such file or directory</code> or <code>/dev/isgx No such file or directory</code></a></li>
        <li><a href="#q-how-to-check-if-my-installed-driver-is-sgx-or-dcap">Q: How to check if my installed driver is SGX or DCAP?</a></li>
        <li><a href="#q-i-suspect-some-docker-container-dies--hangs--doesnt-run-correctly-but-how-can-i-debug">Q: I suspect some docker container dies / hangs / doesn't run correctly but how can I debug?</a></li>
        <li><a href="#q-how-can-i-dump-the-logs-from-the-containers">Q: How can I dump the logs from the containers?</a></li>
        <li><a href="#q-what-if-my-machine-id-is-empty-after-ive-run-all-the-commands">Q: What if my Machine ID is empty after I've run all the commands?</a></li>
      </ul>
    </li>
    <li><a href="#v-operations-on-chain">V. Operations On-chain</a>
      <ul>
        <li><a href="#q-can-i-bond-the-controller-account-with-multiple-stash-accounts">Q: Can I bond the controller account with multiple stash accounts?</a></li>
        <li><a href="#q-why-my-balance-didnt-change-after-i-have-started-mining">Q: Why my balance didn't change after I have started mining?</a></li>
        <li><a href="#q-got-error-not-controller-while-setting-commission">Q: Got error <code>Not Controller</code> while setting commission</a></li>
      </ul>
    </li>
    <li><a href="#vi-restart-your-phost">VI. Restart your pHost</a>
      <ul>
        <li><a href="#q-it-reads-errblockheadermismatch-after-i-restarted-the-phost">Q: It reads <code>Err(BlockHeaderMismatch)</code> after I restarted the pHost.</a></li>
        <li><a href="#q-can-i-run-the-restart-command-directly-instead-of-using-kill-and-run-">Q: Can I run the <code>restart</code> command directly instead of using <code>kill</code> and <code>run</code> ?</a></li>
      </ul>
    </li>
    <li><a href="#vii-other">VII. Other</a>
      <ul>
        <li><a href="#q-i-cant-claim-test-tokens-after-clicking-click-to-burn-or-click-to-claim">Q: I can't claim test tokens after clicking <code>Click to burn</code> or <code>Click to claim</code></a></li>
        <li><a href="#q-error-happens-when-i-tried-to-run-the-self-examination-program">Q: Error happens when I tried to run the self-examination program</a></li>
      </ul>
    </li>
  </ul>
</nav>
        <h3 class="section_link"><a id="docs-41-error-references" href="https://wiki.phala.network/en-us/docs/poc3/4.1-error-references/">4.1 Error References</a></h3><nav id="TableOfContents"></nav>
      </section>
  </section>
  <section class="section">
    <h2 class="section_title"><a  href="https://wiki.phala.network/en-us/docs/poc2/" class="group">Legacy Docs (PoC-2)</a></h2>
      <section class="subsection" id="docs-legacy-docs-poc-2">
        <h3 class="section_link"><a id="docs-run-a-full-node" href="https://wiki.phala.network/en-us/docs/poc2/run-a-full-node/">Run a full node</a></h3><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#types-of-nodes">Types of Nodes</a></li>
        <li><a href="#fast-install-instructions-linux">Fast Install Instructions (Linux)</a></li>
        <li><a href="#fast-install-instructions-mac">Fast Install Instructions (Mac)</a></li>
      </ul>
    </li>
    <li><a href="#participate-testnet-poc-2-promotion-events">Participate Testnet PoC-2 promotion events</a></li>
    <li><a href="#get-substrate">Get Substrate</a></li>
    <li><a href="#clone-and-build">Clone and Build</a></li>
    <li><a href="#run">Run</a></li>
    <li><a href="#running-an-archive-node">Running an Archive Node</a></li>
    <li><a href="#using-docker">Using Docker</a></li>
  </ul>
</nav>
      </section>
  </section>
      </section>
  </section>
</aside>

  </div>
  <section class="content">
    <h1>Run a Gatekeeper</h1><h2 id="setup-environment">Setup Environment</h2>
<ul>
<li>
<p><strong>Hardware</strong></p>
<ul>
<li><strong>CPU</strong>: 6th generation or newer Intel Core/Pentium/Celeron/Atom series.</li>
<li><strong>Memory</strong>: 2GB - 8GB. 2GB is indeed the minimum memory you should operate your Gatekeeper with. For better performance, you can bump it up to 4GB or 8GB, but memory more than that is unnecessary. In order to compile the binary yourself, you will need around 8GB memory.</li>
<li><strong>Mainboard</strong>: SGX-supported mainboard, and newer mainboards can support more SGX features. <strong>We strongly recommend you to consult our Miner Community team about the SGX module before purchasing a board to mine PHA.</strong></li>
<li><strong>Storage</strong> - A NVMe solid state drive, and should be reasonably sized to deal with blockchain growth. A SSD of 80GB - 160GB will be enough for the first six months of Phala Network, but this requirement needs to be re-evaluated every six months.
For more detail, you may refer to the <a href="https://wiki.phala.network/en-us/docs/poc3/1-1-hardware-configuration/">miner node requirement</a>.</li>
</ul>
</li>
<li>
<p><strong>Software</strong></p>
<ul>
<li>Ubuntu 18.04/20.04</li>
<li>Install <a href="https://wiki.phala.network/en-us/docs/poc3/1-2-software-configuration/#install-docker-ce">Docker-CE</a></li>
<li>Install <a href="https://wiki.phala.network/en-us/docs/poc3/1-1-hardware-configuration/#sgx-driver-installation">SGX drivers</a></li>
<li>Bandwidth：the stabler, the better</li>
</ul>
</li>
</ul>
<p>The specs posted above are by no means the minimum specs that you could use when running a
<strong>Gatekeeper</strong>.</p>
<br>
<h2 id="synchronize-chain-data">Synchronize Chain Data</h2>
<ol>
<li>
<p>Download the <a href="https://drive.google.com/file/d/1meYBcEwZViezeY0ksC34K0qAe6AiFlsv/view?usp=sharing">GK setup package</a>.</p>
</li>
<li>
<p>Open your Terminal and run the commands below:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">sudo cp ./poc3_validator.service /etc/systemd/system
sudo systemctl <span class="nb">enable</span> poc3_validator.service
sudo systemctl start poc3_validator.service
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Type in <code>vim validator.sh</code> , press <code>a</code>, and replace <code>YOUR NAME</code> with a cool node name you like. 🤟</p>
</li>
<li>
<p>Press <code>ESC</code>,  and press <code>Shift</code> + <code>;</code> , type in <code>wq</code> , and press <code>Enter</code> to save and return.</p>
</li>
<li>
<p>Go to <a href="https://telemetry.polkadot.io/#list/Phala%20PoC-3">https://telemetry.polkadot.io/#list/Phala PoC-3</a>, find your node name, and wait for its block synchronization until it's the same with others. The synchronization may take 1-2 hours and the exact duration depends on your bandwidth.</p>
</li>
</ol>
<h3 id="to-compile-your-gatekeeper-node">*To Compile Your Gatekeeper Node</h3>
<p>Download the latest Phala Network binary from the Github <a href="https://github.com/Phala-Network/phala-blockchain/releases">release page</a>.</p>
<p>You can also build the <code>phala-node</code> binary from the
<a href="https://github.com/Phala-Network/phala-blockchain">Phala-Network/phala-blockchain</a> repository on GitHub using the source
code available in the <strong>master</strong> branch. You will need to prepare the Rust build environment described in the <a href="/en-us/docs/poc2/run-a-full-node/">Run a Full Node</a> tutorial.</p>
<blockquote>
<p>Note: If you prefer to use SSH rather than HTTPS, you can replace the first line of the below with
<code>git clone git@github.com/Phala-Network/phala-blockchain.git</code>.</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">  git clone https://github.com/Phala-Network/phala-blockchain
  <span class="nb">cd</span> phala-blockchain
  ./scripts/init.sh
  git submodule update --init
  cargo build --release
</code></pre></td></tr></table>
</div>
</div><p>This step will take a while (generally 10 - 40 minutes, depending on your hardware).</p>
<blockquote>
<p><strong>Note</strong>: If you run into compile errors, you may have to switch to a less recent nightly Rust compiler. This can be
done by running:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">rustup install nightly-2020-05-15
rustup override <span class="nb">set</span> nightly-2020-05-15
rustup target add wasm32-unknown-unknown --toolchain nightly-2020-05-15
</code></pre></td></tr></table>
</div>
</div></blockquote>
<p>If you are interested in generating keys locally, you can also install <code>subkey</code> from the same
directory. You may then take the generated <code>subkey</code> executable and transfer it to an air-gapped
machine for extra security.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">cargo install --force --git https://github.com/paritytech/substrate subkey
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><strong>Note</strong>: By default, Gatekeeper nodes are in archive mode. If you've already synced the chain not
in archive mode, you must first remove the database with <code>phala-node purge-chain</code> and then ensure
that you run Phala Network with the <code>--pruning=archive</code> option.</p>
<p>You may run a Gatekeeper node in non-archive mode by adding the following flags:
<code>-unsafe-pruning --pruning OF BLOCKS&gt;</code>, but note that an archive node and non-archive node's
databases are not compatible with each other, and to switch you will need to purge the chain data.</p>
</blockquote>
<p>You can begin syncing your node by running the following command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">./phala-node --pruning<span class="o">=</span>archive
</code></pre></td></tr></table>
</div>
</div><p>if you do not want to start in Gatekeeper mode right away.</p>
<p>The <code>--pruning=archive</code> flag is implied by the <code>--validator</code> and <code>--sentry</code> flags, so it is only
required explicitly if you start your node without one of these two options. If you do not set your
pruning to archive node, even when not running in Gatekeeper and sentry mode, you will need to
re-sync your database when you switch.</p>
<blockquote>
<p><strong>Note</strong>: Gatekeepers should sync using the RocksDb backend. This is implicit by default, but can
be explicit by passing the <code>--database RocksDb</code> flag. In the future, it is recommended to switch
to using the faster and more efficient ParityDb option. Switching between database backends will
require a resync.</p>
<p>If you want to test out ParityDB you can add the flag <code>--database paritydb</code>.</p>
</blockquote>
<p>Depending on the size of the chain when you do this, this step may take a few minutes
to a few hours.</p>
<p>If you are interested in determining how much longer you have to go, your server logs (printed to
STDOUT from the <code>phala-node</code> process) will tell you the latest block your node has processed and
verified. You can then compare that to the current highest block via
<a href="https://telemetry.polkadot.io/#list/Phala%20PoC-2">Telemetry</a> or the
<a href="https://app.phala.network/#/explorer">Phala Web App</a>.</p>
<blockquote>
<p><strong>Note</strong>: If you do not already have PHA, this is as far as you will be able to go until the end
of the soft launch period. You can still run a node, but you will need to have a minimal amount of
PHA to continue, as balance transfers are disabled during the soft launch. Please keep in mind
that Gatekeepers will be re-elected when the NPoS phase starts.</p>
</blockquote>
<br>
<h2 id="bond-pha">Bond PHA</h2>
<blockquote>
<p>The steps below have to be processed on the device you have set up.</p>
</blockquote>
<ol>
<li><a href="https://www.notion.so/Create-Accounts-710e6dccac6f45d2953f5ea84206a58e">Create 2 accounts</a> and be ensured that you have saved <strong>the mnemonics of your controller</strong> account correctly.</li>
<li><a href="https://www.notion.so/Claim-Test-Tokens-9f53f6b805634f84bd44f202ef53b11c">Claim test tokens</a> and be ensured that there are over <code>100 tPHA</code> in the stash account and the controller account.</li>
<li>Go to <code>Network</code> → <code>Staking</code> → <code>Account Actions</code> → <code>+Stash</code></li>
<li>Type in an amount of tPHA that you would like to bond.</li>
<li>Click <code>Bond</code> and Sign.</li>
</ol>
<blockquote>
<ul>
<li><strong>Stash account</strong> - Select your Stash account. In this example, we will bond 100 PHA - make sure that your Stash account contains <em>at least</em> this much. You can, of course, stake more than this.</li>
<li><strong>Controller account</strong> - Select the Controller account created earlier. This account will also need a small amount of PHA in order to start and stop validating.</li>
<li><strong>Value bonded</strong> - How much PHA from the Stash account you want to bond/stake. Note that you do not need to bond all of the PHA in that account, and you can always bond <em>more</em> PHA later. However, <em>withdrawing</em> any bonded amount requires the duration of the unbonding period. In Phala Network, the unbonding period is 7 days.</li>
<li><strong>Payment destination</strong> - The account to which the rewards from validating are sent. More info <a href="https://wiki.polkadot.network/en/latest/polkadot/learn/staking/#reward-distribution">here</a>.</li>
</ul>
</blockquote>
<p>After a few seconds, you should see an &quot;ExtrinsicSuccess&quot; message. You should now see a list with all your accounts (you may need to refresh the web page). The bonded amount on the right corresponds to the funds bonded by the Stash account.</p>
<p><img src="/images/docs/gatekeeper/1.png" alt="">
<img src="/images/docs/gatekeeper/2.png" alt="">
<img src="/images/docs/gatekeeper/3.png" alt=""></p>
<br>
<h2 id="set-session-keys">Set Session Keys</h2>
<blockquote>
<p><strong>Note</strong>: The session keys are consensus critical, so if you are not sure if your node has the
current session keys that you made the <code>setKeys</code> transaction then you can use one of the two available RPC methods to query your node: <a href="https://polkadot.js.org/api/substrate/rpc.html#haskey-publickey-bytes-keytype-text-bool">hasKey</a> to check for a specific key or <a href="https://polkadot.js.org/api/substrate/rpc.html#hassessionkeys-sessionkeys-bytes-bool">hasSessionKeys</a> to check the full session key public key string.</p>
</blockquote>
<h3 id="generating-the-session-keys">Generating the Session Keys</h3>
<p>You need to tell the chain your Session keys by signing and submitting an extrinsic. This is what associates your Gatekeeper node with your Controller account in Phala Network.</p>
<h4 id="option-1-polkadotjs-apps">Option 1: PolkadotJS-APPS</h4>
<ol>
<li>Click the Phala logo → <code>DEVELOPMENT</code>, and type in <code>ws://127.0.0.1:9944</code> , and click <code>Switch</code>.</li>
<li>Go to <code>Developers</code> → <code>RPC Calls</code>, choose <code>author</code> → <code>rotateKeys()</code>, and click <code>Submit</code>. The number string on the page is exactly your session key. Copy your session key.</li>
<li>Go back to <code>Network</code> → <code>Staking</code> → <code>Account Actions</code>, click <code>Set Sessionkey</code> right next to your bonded accounts. Paste the session key and save.</li>
</ol>
<p><img src="/images/docs/gatekeeper/4.png" alt="">
<img src="/images/docs/gatekeeper/5.png" alt=""></p>
<h4 id="option-2-cli">Option 2: CLI</h4>
<p>If you are on a remote server, it is easier to run this command on the same machine (while the node is running with the default HTTP RPC port configured):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">curl -H <span class="s2">&#34;Content-Type: application/json&#34;</span> -d <span class="s1">&#39;{&#34;id&#34;:1, &#34;jsonrpc&#34;:&#34;2.0&#34;, &#34;method&#34;: &#34;author_rotateKeys&#34;, &#34;params&#34;:[]}&#39;</span> http://localhost:9933
</code></pre></td></tr></table>
</div>
</div><p>The output will have a hex-encoded &quot;result&quot; field. The result is the concatenation of the four
public keys. Save this result for a later step.
You can restart your node at this point, omitting the <code>--unsafe-rpc-expose</code> flag as it is no longer needed.</p>
<h3 id="set-your-sessions-keys">Set Your Sessions Keys</h3>
<ol>
<li>Go to <code>Network</code> → <code>Staking</code> → <code>Account Actions</code>, click <code>Set Sessionkey</code> right next to your bonded accounts. Paste the number string and save.</li>
<li>Now we go to <code>Developers</code> → <code>Extrinsics</code>, choose your stash account at the first line, choose <code>phalaModule</code> → <code>setStash(controller)</code> at the second line, choose your controller account at the third line. Click <code>Submit Transaction</code>.</li>
</ol>
<p><img src="/images/docs/gatekeeper/6.png" alt="">
<img src="/images/docs/gatekeeper/7.png" alt=""></p>
<br>
<h2 id="pruntime-setup">pRuntime Setup</h2>
<ol>
<li>
<p>Type in <code>sudo docker pull phalanetwork/phala-poc3-pruntime</code> to pull Phala pRuntime mirror files. It may take 10-30 mins according to the bandwidth of your network.</p>
</li>
<li>
<p>Choose and type the commands below based on your driver.
<strong>DCAP driver:</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">sudo docker run -d -ti --rm --name phala-pruntime -p 8000:8000 -v <span class="nv">$HOME</span>/phala-pruntime-data:/root/data --device /dev/sgx/enclave --device /dev/sgx/provision phalanetwork/phala-poc3-pruntime
</code></pre></td></tr></table>
</div>
</div><p><strong>SGX driver:</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">sudo docker run -d -ti --rm --name phala-pruntime -p 8000:8000 -v <span class="nv">$HOME</span>/phala-pruntime-data:/root/data --device /dev/isgx phalanetwork/phala-poc3-pruntime
</code></pre></td></tr></table>
</div>
</div></li>
</ol>
<blockquote>
<p>How to check the driver type of your computer?</p>
<ul>
<li>Run <code>ls /dev/isgx</code> and it returns feedback: you are using <strong>SGX driver</strong>;</li>
<li>Run <code>ls /dev/sgx</code> and it returns feedback: you are using <strong>DCAP driver</strong></li>
</ul>
<p>If both of the commands work, use the commands of the DCAP driver in the following steps.
If none of them work, please refer to <a href="https://wiki.phala.network/en-us/docs/poc3/1-1-hardware-configuration/#sgx-driver-installation">the SGX driver installation</a> in Phala Guide.</p>
</blockquote>
<br>
<h2 id="phost-setup">pHost Setup</h2>
<ol>
<li>Type in <code>vim runphost.sh</code> in your Terminal.</li>
<li>Press <code>a</code> until there's an <code>INSERT</code> tag at the lower-left corner. Replace the <code>Key Key Key ... Key</code> with <strong>your controller mnemonics</strong>. Press <code>ESC</code>, then press <code>Shift</code> + <code>;</code> , type in <code>wq</code> , and press <code>Enter</code> to save and return.</li>
<li>Type in <code>./runphost.sh</code> . Wait for a moment until it reads <code>OK(())</code> .</li>
</ol>
<blockquote>
<p>If it returns errors as below:
<code>...FailedToCallRegisterWorker: Err(Rpc(Request(Error { code: ServerError(1010), message: &quot;Invalid Transaction&quot;, data: Some(String(&quot;Inability to pay some fees (e.g. account balance too low)&quot;)) }))) bridge() exited with result: Err(FailedToCallRegisterWorker)</code>
Please kindly check your mnemonics written in <code>vim runphost.sh</code> or your operations in step 2 &amp; step 3.</p>
</blockquote>
<p><img src="/images/docs/gatekeeper/8.png" alt="">
<img src="/images/docs/gatekeeper/9.png" alt="">
<img src="/images/docs/gatekeeper/10.png" alt=""></p>
<br>
<h2 id="validate-your-gatekeeper">Validate Your Gatekeeper</h2>
<ol>
<li>Go to <code>Network</code> → <code>Staking</code> → <code>Account Actions</code></li>
<li>Click the <code>Validate</code> button right next to your bonded accounts.</li>
<li>Set the commission rate and sign.</li>
<li>Your controller node will be on the <a href="https://poc3.phala.network/#/staking/waiting">waiting list</a> in the next <a href="https://wiki.polkadot.network/docs/en/glossary#epoch">Epoch</a>.</li>
</ol>
<p><img src="/images/docs/gatekeeper/11.png" alt="">
<img src="/images/docs/gatekeeper/12.png" alt="">
<img src="/images/docs/gatekeeper/13.png" alt=""></p>
<blockquote>
<p><strong>Note</strong>: This step will fail if you haven't successfully registered an SGX-enabled worker on your controller account. Please double check the steps before to make sure your hardware is correctly registered.</p>
</blockquote>
<p>If you go to the &quot;Staking&quot; tab, you will see a list of active Gatekeepers currently running on the
network. At the top of the page, it shows the number of Gatekeeper slots that are available as well as the number of nodes that have signaled their intention to be a Gatekeeper. You can go to the &quot;Waiting&quot; tab to double check to see whether your node is listed there.</p>
<p><img src="https://wiki.polkadot.network/docs/assets/guides/how-to-validate/polkadot-dashboard-staking.jpg" alt="staking queue"></p>
<p>The Gatekeeper set is refreshed every era. In the next era, if there is a slot available and your
node is selected to join the Gatekeeper set, your node will become an active Gatekeeper. Until then, it will remain in the <em>waiting</em> queue. If your Gatekeeper is not selected to become part of the Gatekeeper set, it will remain in the <em>waiting</em> queue until it is. There is no need to re-start if you are not selected for the Gatekeeper set in a particular era. However, it may be necessary to increase the number of PHA staked or seek out nominators for your Gatekeeper in order to join the Gatekeeper set.</p>
<br>
<h3 id="miner-community">Miner Community</h3>
<p><a href="https://discord.gg/FUtZzYH"><img src="https://img.shields.io/discord/697726436211163147?label=Phala%20Discord" alt=""></a> <a href="https://t.me/joinchat/PDXFHFI9RXcOKMaumhTTvw"><img src="https://img.shields.io/badge/Join-Telegram-blue" alt=""></a></p>

    <div class="pager pager_lean">
  

  
  <div class="pager_item next">
    
    <a href="https://wiki.phala.network/en-us/docs/poc2/run-a-full-node/" class="pager_link button" title="Run a full node">
      <span class="pager_label">Run a full node</span>
      <img class="pager_link_next light" src="https://wiki.phala.network/images/next.svg">
      <img class="pager_link_next dark" src="https://wiki.phala.network/images/next-dark.svg">
    </a>
  </div>
  
</div>
<svg width="0" height="0" class="hidden">
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 492.004 492.004" id="next">
    <path d="M484.14 226.886L306.46 49.202c-5.072-5.072-11.832-7.856-19.04-7.856-7.216 0-13.972 2.788-19.044 7.856l-16.132 16.136c-5.068 5.064-7.86 11.828-7.86 19.04 0 7.208 2.792 14.2 7.86 19.264L355.9 207.526H26.58C11.732 207.526 0 219.15 0 234.002v22.812c0 14.852 11.732 27.648 26.58 27.648h330.496L252.248 388.926c-5.068 5.072-7.86 11.652-7.86 18.864 0 7.204 2.792 13.88 7.86 18.948l16.132 16.084c5.072 5.072 11.828 7.836 19.044 7.836 7.208 0 13.968-2.8 19.04-7.872l177.68-177.68c5.084-5.088 7.88-11.88 7.86-19.1.016-7.244-2.776-14.04-7.864-19.12z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 511.999 511.999" id="search">
    <path d="M508.874 478.708L360.142 329.976c28.21-34.827 45.191-79.103 45.191-127.309C405.333 90.917 314.416 0 202.666 0S0 90.917 0 202.667s90.917 202.667 202.667 202.667c48.206 0 92.482-16.982 127.309-45.191l148.732 148.732c4.167 4.165 10.919 4.165 15.086 0l15.081-15.082c4.165-4.166 4.165-10.92-.001-15.085zM202.667 362.667c-88.229 0-160-71.771-160-160s71.771-160 160-160 160 71.771 160 160-71.771 160-160 160z"></path>
  </symbol>
</svg>
  </section>
</div>

  </main>
<footer class="mt-2 pt-2 pb-2">
  <div class="wrap">
    <p>&copy; 2020 Phala Network</p>
  </div>
</footer>


<svg width="0" height="0" class="hidden">
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 492.004 492.004" id="next">
    <path d="M484.14 226.886L306.46 49.202c-5.072-5.072-11.832-7.856-19.04-7.856-7.216 0-13.972 2.788-19.044 7.856l-16.132 16.136c-5.068 5.064-7.86 11.828-7.86 19.04 0 7.208 2.792 14.2 7.86 19.264L355.9 207.526H26.58C11.732 207.526 0 219.15 0 234.002v22.812c0 14.852 11.732 27.648 26.58 27.648h330.496L252.248 388.926c-5.068 5.072-7.86 11.652-7.86 18.864 0 7.204 2.792 13.88 7.86 18.948l16.132 16.084c5.072 5.072 11.828 7.836 19.044 7.836 7.208 0 13.968-2.8 19.04-7.872l177.68-177.68c5.084-5.088 7.88-11.88 7.86-19.1.016-7.244-2.776-14.04-7.864-19.12z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 511.999 511.999" id="search">
    <path d="M508.874 478.708L360.142 329.976c28.21-34.827 45.191-79.103 45.191-127.309C405.333 90.917 314.416 0 202.666 0S0 90.917 0 202.667s90.917 202.667 202.667 202.667c48.206 0 92.482-16.982 127.309-45.191l148.732 148.732c4.167 4.165 10.919 4.165 15.086 0l15.081-15.082c4.165-4.166 4.165-10.92-.001-15.085zM202.667 362.667c-88.229 0-160-71.771-160-160s71.771-160 160-160 160 71.771 160 160-71.771 160-160 160z"></path>
  </symbol>
</svg>
<script src="https://wiki.phala.network/js/bundle.min.178aa2a740cfcbf4e6f0049bc9e83012daac7e717754fc6c8a578411627961f20a43360b7e1a8f0959c4efcc1065e22d235f7b4c91a311f5ce548d4435719d6b.js"></script>
<script src="https://wiki.phala.network/js/search.min.8a97009604c86da25bb1bc70c485931bb43dfb67e8b0c76e0c16e4fdc46848948c31371b49e048ab3906f430443f93a3f00c8f73867cd232c71fe3bebe391cd3.js" async defer></script>

</body>
</html>
